<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Lokonex</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+Telugu:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<!-- PWA Manifest -->
<link rel="manifest" href="manifest.json">

<!-- Cache Control -->
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />

<!-- ‚úÖ ENHANCED MOBILE DATA LOADER - REPLACE WITH THIS -->
<script>
// ENHANCED MOBILE DATA LOAD FIX
function enhancedMobileLoader() {
  console.log("üì± ENHANCED Mobile loader started");
  
  // Multiple fallback attempts
  setTimeout(loadMobileVendors, 1000);   // Try after 1 sec
  setTimeout(loadMobileVendors, 3000);   // Try after 3 sec  
  setTimeout(loadMobileVendors, 5000);   // Try after 5 sec
  setTimeout(loadMobileVendors, 10000);  // Try after 10 sec
}

function loadMobileVendors() {
  console.log("üîÑ Loading mobile vendors...");
  
  // Check if already loaded
  if (window.vendors && window.vendors.length > 0) {
    console.log("‚úÖ Vendors already loaded, displaying...");
    if (typeof showVendors === 'function') showVendors();
    return;
  }
  
  // Try Firebase first
  fetch('https://local-market2025-default-rtdb.asia-southeast1.firebasedatabase.app/vendors.json')
    .then(r => r.json())
    .then(data => {
      console.log("üì¶ Firebase data received");
      const vendorsArray = Object.values(data || {});
      window.vendors = vendorsArray.map(v => ({...v, approved: true}));
      localStorage.setItem('vendors_v2', JSON.stringify(window.vendors));
      console.log("‚úÖ Mobile vendors loaded:", window.vendors.length);
      
      // Force display
      if (typeof showVendors === 'function') {
        showVendors();
        console.log("üéâ Vendors displayed successfully!");
      }
    })
    .catch(err => {
      console.error("‚ùå Firebase failed, trying localStorage...");
      // Fallback to localStorage
      const stored = localStorage.getItem('vendors_v2');
      if (stored) {
        window.vendors = JSON.parse(stored);
        console.log("üì¶ Loaded from storage:", window.vendors.length);
        if (typeof showVendors === 'function') showVendors();
      }
    });
}

// Run enhanced loader on mobile
if (/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
  console.log("üì± Mobile device detected - starting enhanced loader");
  enhancedMobileLoader();
}
</script>
<!-- ‚úÖ END ENHANCED MOBILE DATA LOADER -->
  
<style>
/* All your existing CSS remains exactly the same */
*{margin:0;padding:0;box-sizing:border-box}
html, body {
  height: 100%;
  width: 100%;
  overflow-x: hidden;
}
body{
  font-family:'Inter',sans-serif;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:#fff;
  min-height:100vh;
  overflow-x:hidden;
  padding-top:70px;
}
header{
  position:fixed;
  top:0;
  left:0;
  right:0;
  background:rgba(15,32,39,0.95);
  backdrop-filter:blur(12px);
  border-bottom:1px solid rgba(255,215,0,0.2);
  z-index:1000;
  padding:0.8rem 4%;
  display:flex;
  justify-content:space-between;
  align-items:center;
  flex-wrap:nowrap;
  gap:1rem;
}
@keyframes pulse {
  0%,100% { transform: scale(1) }
  50% { transform: scale(1.1) }
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateX(100px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes spin {
  to { transform: rotate(360deg); }
}




.logo{font-size:1.5rem;font-weight:700;background:linear-gradient(90deg,#ffd700,#ff8c00);-webkit-background-clip:text;-webkit-text-fill-color:transparent;display:flex;align-items:center;gap:8px;white-space:nowrap}
.logo img{width:32px;height:32px;border-radius:50%;border:2px solid #ffd700}
.datetime{font-size:0.75rem;color:#ffd700;font-weight:500;white-space:nowrap;text-align:center;flex-shrink:0;position:absolute;left:50%;transform:translateX(-50%);}
nav{display:flex;gap:0.8rem;flex-wrap:nowrap;justify-content:center;overflow-x:auto;padding-bottom:2px}
nav::-webkit-scrollbar{height:3px}
nav::-webkit-scrollbar-thumb{background:#ffd700;border-radius:10px}
nav a{font-weight:500;color:#fff;cursor:pointer;padding:0.4rem 0.5rem;position:relative;white-space:nowrap;font-size:0.85rem;flex-shrink:0}
nav a::after{content:'';position:absolute;bottom:0;left:0;width:0;height:2px;background:#ffd700;transition:0.3s}
nav a:hover::after{width:100%}
.page{display:none;padding:5rem 2% 2rem;min-height:100vh;width:100%;overflow-x:hidden}
.page.active{display:block}
.card{background:rgba(255,255,255,0.1);backdrop-filter:blur(12px);border:1px solid rgba(255,215,0,0.3);border-radius:16px;padding:1.5rem;box-shadow:0 10px 40px rgba(0,0,0,0.4);max-width:900px;margin:auto;width:100%}
.glow-btn{background:linear-gradient(45deg,#ffd700,#ff8c00);color:#000;border:none;padding:0.6rem 1rem;border-radius:50px;font-weight:600;cursor:pointer;box-shadow:0 0 25px rgba(255,215,0,0.6);transition:0.3s;font-size:0.8rem}
.glow-btn:hover{transform:scale(1.06);box-shadow:0 0 40px rgba(255,215,0,0.9)}
label{display:block;margin:1.2rem 0 0.5rem;font-weight:500;color:#ffd700;font-size:1rem}
input,select,textarea{width:100%;padding:0.9rem;border-radius:12px;border:none;background:rgba(255,255,255,0.2);color:#fff;font-size:1rem;appearance:none;-webkit-appearance:none}
select{background:rgba(255,255,255,0.2) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath fill='%23ffd700' d='M0 0l6 8 6-8z'/%3E%3C/svg%3E") no-repeat right 1rem center;background-size:10px}
option{background:#203a43;color:#fff}
#custom-service{display:none;margin-top:0.5rem}
.vendor-card{text-align:center;margin-bottom:2rem;position:relative}
.vendor-card img{width:100px;height:100px;object-fit:cover;border-radius:50%;border:3px solid #ffd700;margin-bottom:1rem}
#popup,#contact-popup{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#000;padding:1.5rem 2rem;border-radius:16px;border:3px solid #ffd700;box-shadow:0 0 40px #ffd700;z-index:9999;text-align:center;display:none;width:90%;max-width:350px}
#popup.show,#contact-popup.show{display:block}
#popup button,#contact-popup button{margin-top:1rem;background:#ffd700;color:#000;padding:0.7rem 1.5rem;border-radius:50px;width:100%}
.banner{text-align:center;padding:1rem 0.5rem;width:100%}
.banner h1{font-size:1.8rem;background:linear-gradient(90deg,#ffd700,#fff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:0.5rem;line-height:1.3}
.telugu{font-family:'Noto Sans Telugu',sans-serif}
.search-bar{max-width:100%;margin:1.5rem auto;display:flex}
.search-bar input{flex:1;border-radius:12px 0 0 12px}
.search-bar button{border-radius:0 12px 12px 0}
.categories{display:grid;grid-template-columns:repeat(auto-fit,minmax(110px,1fr));gap:0.8rem;margin:1.5rem 0}
.category-btn{background:rgba(255,255,255,0.1);border:2px solid #ffd700;padding:0.8rem;border-radius:16px;text-align:center;cursor:pointer;font-weight:500;font-size:0.8rem}
.category-btn:hover{background:#ffd700;color:#000}
.vendor-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:1.2rem}
.vendor-box{background:rgba(255,255,255,0.08);border-radius:16px;padding:1.2rem;border:1px solid rgba(255,215,0,0.3);transition:transform 0.3s, box-shadow 0.3s}
.vendor-box:hover{transform:translateY(-5px);box-shadow:0 10px 25px rgba(255,215,0,0.2)}
.vendor-header{display:flex;align-items:center;gap:1rem;margin-bottom:1rem}
.vendor-img{width:70px;height:70px;border-radius:50%;border:2px solid #ffd700;object-fit:cover}
.vendor-info{text-align:left;flex:1}
.vendor-info h3{margin-bottom:0.5rem;color:#ffd700;font-size:1.1rem}
.vendor-details{text-align:left;margin-bottom:1.2rem}
.vendor-detail{display:flex;align-items:center;gap:0.5rem;margin-bottom:0.5rem;font-size:0.9rem}
.vendor-detail i{color:#ffd700;width:18px}
.vendor-actions{display:flex;gap:0.5rem;justify-content:center}
.call-btn{background:#25d366!important;color:#fff!important}
.whatsapp-btn{background:#075e54!important;color:#fff!important}
#payment-page{background:#111;padding:1.5rem;text-align:center}
#payment-page img{max-width:100%;height:auto;border-radius:16px;border:5px solid #ffd700;margin:1rem 0}
footer{text-align:left;padding:1.5rem 1rem;background:rgba(0,0,0,0.7);font-size:0.85rem;margin-top:2rem}
.footer-content{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1.5rem;max-width:1200px;margin:0 auto}
.footer-section h3{color:#ffd700;margin-bottom:1rem;font-size:1.1rem}
.footer-section a{color:#fff;text-decoration:none;display:block;margin-bottom:0.5rem;transition:color 0.3s;font-size:0.85rem;cursor:pointer}
.footer-section a:hover{color:#ffd700}
.footer-section p{margin-bottom:0.5rem;text-align:left;font-size:0.85rem}
.social-icons{display:flex;gap:0.8rem;margin-top:1rem}
.social-icons a{color:#ffd700;font-size:1.3rem;transition:transform 0.3s}
.social-icons a:hover{transform:scale(1.2)}
.copyright{margin-top:1.5rem;padding-top:1rem;border-top:1px solid rgba(255,215,0,0.3);text-align:center}
.expired{color:#e74c3c;font-weight:700}
#admin-body td,#admin-body th{padding:8px 6px;font-size:0.8rem;text-align:left}
#admin-body th{background:#ffd700;color:#000}
#admin-body tr:nth-child(even){background:rgba(255,255,255,0.05)}
#admin-body button{margin:2px;padding:3px 8px;font-size:0.75rem}
.about-grid{display:grid;grid-template-columns:1fr;gap:1.5rem;margin:1.5rem 0}
.about-col{background:rgba(255,255,255,0.08);padding:1.5rem;border-radius:16px;border:1px solid rgba(255,215,0,0.2)}
.icon-glow{font-size:1.8rem;color:#ffd700;filter:drop-shadow(0 0 10px #ffd700);animation:pulse 2s infinite}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}
.project-features{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1.2rem;margin:1.5rem 0}
.feature-card{background:rgba(255,255,255,0.08);padding:1.2rem;border-radius:16px;border:1px solid rgba(255,215,0,0.2);text-align:center}
.feature-card i{font-size:2.2rem;color:#ffd700;margin-bottom:1rem}
.legal-notice{background:rgba(255,215,0,0.1);border:1px solid rgba(255,215,0,0.3);border-radius:12px;padding:1.2rem;margin:1.5rem 0;font-size:1rem;line-height:1.6;text-align:left}
.legal-notice p{margin-bottom:1rem;text-align:left}
.legal-notice strong{color:#ffd700;font-size:1.1rem}
.about-hero{text-align:center;margin-bottom:2rem;padding:0 0.5rem}
.about-hero h1{font-size:1.8rem;background:linear-gradient(90deg,#ffd700,#ff8c00,#ffd700);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:1rem;line-height:1.3}
.about-hero p{font-size:1rem;max-width:100%;margin:0 auto;line-height:1.4}
.about-content{display:flex;flex-direction:column;gap:1.5rem}
.about-section{padding:1.5rem;border-radius:16px;border-left:5px solid #ffd700}
.about-section h2{color:#ffd700;margin-bottom:1rem;display:flex;align-items:center;gap:10px;font-size:1.3rem}
.about-section p{line-height:1.6;margin-bottom:1rem;font-size:0.95rem;text-align:justify}
.about-highlights{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:1.2rem;margin:1.5rem 0}
.highlight-item{text-align:center;padding:1.2rem}
.highlight-item i{font-size:2.2rem;color:#ffd700;margin-bottom:1rem}
.contact-info{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:1.2rem;margin-top:1.5rem}
.contact-card{background:rgba(255,255,255,0.05);padding:1.2rem;border-radius:12px;text-align:center;min-width:auto}
.contact-card h3{color:#ffd700;margin-bottom:1rem;font-size:1.1rem}
.contact-card a{color:#25d366;text-decoration:none;font-weight:500}
.contact-card a:hover{text-decoration:underline}
.category-management{margin:1rem 0;padding:1rem;background:rgba(255,255,255,0.05);border-radius:12px}
.category-management h3{color:#ffd700;margin-bottom:1rem}
.category-list{display:flex;flex-wrap:wrap;gap:0.5rem;margin-bottom:1rem}
.category-item{background:rgba(255,215,0,0.2);padding:0.5rem 1rem;border-radius:20px;display:flex;align-items:center;gap:0.5rem}
.category-item button{background:#e74c3c;color:white;border:none;border-radius:50%;width:20px;height:20px;cursor:pointer;font-size:0.7rem}

/* Page Headings */
.page h1, .page h2 {
  text-align: center;
  margin-bottom: 1.5rem;
  word-wrap: break-word;
  padding: 0 0.5rem;
}

#home h1 {
  font-size: 1.8rem !important;
}

#about h1 {
  font-size: 1.8rem !important;
}

#vendors h2 {
  font-size: 1.6rem !important;
}

#register h2 {
  font-size: 1.6rem !important;
}

#admin h2 {
  font-size: 1.6rem !important;
}

/* FIXED: Improved placeholder styling */
input::placeholder, textarea::placeholder {
  color: #ffd700 !important;
  opacity: 0.9 !important;
  font-weight: 500 !important;
}

/* FIXED: Sticky search bars */
#home .search-bar, #vendors .search-bar {
  position: sticky;
  top: 60px;
  z-index: 900;
  background: rgba(15,32,39,0.95);
  backdrop-filter: blur(12px);
  padding: 10px 0;
  margin: -10px 0 10px 0;
  border-bottom: 1px solid rgba(255,215,0,0.2);
}

/* Performance optimizations */
.vendor-box, .card, .feature-card {
  transform: translateZ(0);
  backface-visibility: hidden;
  perspective: 1000;
}

html {
  scroll-behavior: smooth;
}

.header, .search-bar {
  will-change: transform;
}

/* FIXED: Mobile-specific adjustments */
@media (max-width: 768px) {
  header{padding:0.6rem 3%;gap:0.5rem}
  .logo{font-size:1.3rem}
  .logo img{display:none}
  .datetime{font-size:0.7rem; position: static; transform: none; order: 2; width: auto;}
  nav{gap:0.5rem; order: 3; width: 100%; justify-content: space-around;}
  nav a{font-size:0.8rem;padding:0.3rem 0.4rem}
  .page{padding:4.5rem 2% 2rem; min-height: calc(100vh - 4.5rem);}
  .banner{padding:0.5rem}
  .banner h1{font-size:1.6rem; display: block !important;}
  .banner p{font-size:0.9rem}
  .card{padding:1rem}
  
  #home h1 {
    font-size: 1.6rem !important;
    display: block !important;
  }
  
  #about h1 {
    font-size: 1.6rem !important;
    display: block !important;
  }
  
  #vendors h2 {
    font-size: 1.4rem !important;
    display: block !important;
  }
  
  #register h2 {
    font-size: 1.4rem !important;
    display: block !important;
  }
  
  #admin h2 {
    font-size: 1.4rem !important;
    display: block !important;
  }
  
  #admin-body {
    font-size: 0.7rem;
  }
  
  #admin-body td, #admin-body th {
    padding: 4px 3px;
    font-size: 0.7rem;
  }
  
  #dashboard .glow-btn {
    display: block !important;
    visibility: visible !important;
  }
  
  input, select, textarea {
    font-size: 16px;
    padding: 0.8rem;
  }
}

@media (max-width: 480px) {
  header{flex-wrap:wrap;padding:0.5rem 2%}
  .logo{font-size:1.2rem; order: 1;}
  .datetime{font-size:0.65rem;order:2;width:auto;margin-top:0;}
  nav{order:3;gap:0.4rem;width:100%;justify-content:space-between}
  nav a{font-size:0.75rem;padding:0.3rem}
  .page{padding:4rem 1% 1.5rem; min-height: calc(100vh - 4rem);}
  .banner h1{font-size:1.4rem; display: block !important;}
  .card{padding:0.8rem}
  .vendor-grid{grid-template-columns:1fr}
  .footer-content{grid-template-columns:1fr;gap:1rem}
  
  #home h1 {
    font-size: 1.4rem !important;
    line-height: 1.2;
    display: block !important;
  }
  
  #about h1 {
    font-size: 1.4rem !important;
    line-height: 1.2;
    display: block !important;
  }
  
  #vendors h2 {
    font-size: 1.3rem !important;
    line-height: 1.2;
    display: block !important;
  }
  
  #register h2 {
    font-size: 1.3rem !important;
    line-height: 1.2;
    display: block !important;
  }
  
  #admin h2 {
    font-size: 1.3rem !important;
    line-height: 1.2;
    display: block !important;
  }
  
  .about-hero h1 {
    font-size: 1.4rem !important;
    line-height: 1.2;
    display: block !important;
  }
  
  .about-hero p {
    font-size: 0.9rem;
    line-height: 1.3;
  }
  
  #admin-body {
    font-size: 0.65rem;
  }
  
  #admin-body td, #admin-body th {
    padding: 3px 2px;
    font-size: 0.65rem;
  }
  
  #admin-body button {
    padding: 2px 4px;
    font-size: 0.6rem;
  }
  
  input, select, textarea {
    padding: 0.7rem;
  }
}

.placeholder-telugu::placeholder {
  font-family: 'Noto Sans Telugu', sans-serif;
  color: #ffd700 !important;
  opacity: 0.9 !important;
  font-weight: 500 !important;
}

.placeholder-english::placeholder {
  font-family: 'Inter', sans-serif;
  color: #ffd700 !important;
  opacity: 0.9 !important;
  font-weight: 500 !important;
}

.page {
  -webkit-overflow-scrolling: touch;
}

.container, .card, .banner, .footer-content {
  max-width: 100%;
  overflow-x: hidden;
}

.vendor-img {
  object-fit: cover;
  background: #203a43;
}

.share-btn {
  background: linear-gradient(45deg, #25d366, #128C7E) !important;
  color: white !important;
  border: none;
  padding: 0.6rem 1rem;
  border-radius: 50px;
  font-weight: 600;
  cursor: pointer;
  box-shadow: 0 0 15px rgba(37, 211, 102, 0.5);
  transition: 0.3s;
  font-size: 0.8rem;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
}

.share-btn:hover {
  transform: scale(1.06);
  box-shadow: 0 0 25px rgba(37, 211, 102, 0.7);
}

.selected-row {
  background-color: rgba(255, 215, 0, 0.2) !important;
}

.contact-number {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  margin-left: 5px;
}

.update-form {
  background: rgba(255, 255, 255, 0.05);
  padding: 1rem;
  border-radius: 12px;
  margin-top: 1rem;
  border: 1px solid rgba(255, 215, 0, 0.3);
}

.update-form h4 {
  color: #ffd700;
  margin-bottom: 1rem;
  text-align: center;
}

.update-form input, .update-form select, .update-form textarea {
  margin-bottom: 0.8rem;
}

/* Vendor Edit Button */
.edit-btn {
  background: linear-gradient(45deg, #3498db, #2980b9) !important;
  color: white !important;
  border: none;
  padding: 0.6rem 1rem;
  border-radius: 50px;
  font-weight: 600;
  cursor: pointer;
  box-shadow: 0 0 15px rgba(52, 152, 219, 0.5);
  transition: 0.3s;
  font-size: 0.8rem;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
}

.edit-btn:hover {
  transform: scale(1.06);
  box-shadow: 0 0 25px rgba(52, 152, 219, 0.7);
}

/* Vendor Edit Form */
.edit-form {
  background: rgba(255, 255, 255, 0.08);
  border-radius: 16px;
  padding: 1.5rem;
  margin-top: 1rem;
  border: 2px solid rgba(52, 152, 219, 0.5);
}

.edit-form h3 {
  color: #3498db;
  margin-bottom: 1rem;
  text-align: center;
}

.edit-form .form-actions {
  display: flex;
  gap: 0.8rem;
  justify-content: center;
  margin-top: 1rem;
}

/* NEW: WhatsApp Support Button */
.whatsapp-support-btn {
  background: linear-gradient(45deg, #25d366, #128C7E) !important;
  color: white !important;
  border: none;
  padding: 0.8rem 1.2rem;
  border-radius: 50px;
  font-weight: 600;
  cursor: pointer;
  box-shadow: 0 0 15px rgba(37, 211, 102, 0.5);
  transition: 0.3s;
  font-size: 0.9rem;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  justify-content: center;
  width: 100%;
  margin-top: 0.5rem;
}

.whatsapp-support-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 0 25px rgba(37, 211, 102, 0.7);
}

/* NEW: Loading Spinner */
.loading-spinner {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid rgba(255,255,255,.3);
  border-radius: 50%;
  border-top-color: #fff;
  animation: spin 1s ease-in-out infinite;
  margin-right: 8px;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

  /* ‚úÖ ADD MOBILE CSS HERE - AT THE END OF STYLE TAG */
@media (max-width: 768px) {
  #vendor-grid {
    display: block !important;
    opacity: 1 !important;
    visibility: visible !important;
  }
  
  .vendor-box {
    display: block !important;
    opacity: 1 !important;
    visibility: visible !important;
    margin-bottom: 1rem;
  }
}
/* ‚úÖ END MOBILE CSS */
</style>

</head>

<body>

<header>
  <div class="logo">
    <div class="logo" style="flex-direction:column;align-items:flex-start;gap:2px;">
      <div style="display:flex;align-items:center;gap:6px;">
        <span style="font-weight:700;background:linear-gradient(90deg,#ffd700,#ff8c00);-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-size:1.8rem;">Lokonex</span>
      </div>
      <div class="telugu" style="font-size:0.85rem;color:#ffd700;margin-left:0px;">‡∞Æ‡∞® ‡∞ä‡∞∞‡±Å ‚Äì ‡∞Æ‡∞® ‡∞∏‡±á‡∞µ‡∞≤‡±Å ‚Äì ‡∞Æ‡∞® ‡∞ï‡∞®‡±Ü‡∞ï‡±ç‡∞ü‡±ç.</div>
    </div>
  </div>
  <div class="datetime" id="datetime">Loading...</div>
  <nav>
    <a onclick="show('home')">Home</a>
    <a onclick="show('about')">About</a>
    <a onclick="show('vendors')">Vendors</a>
    <a onclick="show('register')">Register</a>
    <a onclick="show('admin')">Admin</a>
  </nav>
</header>

<div id="home" class="page active">
  <div class="banner">
    <h1>Connecting People with Local Services</h1>
    <p style="font-size:1.2rem;margin:0.5rem 0">Quickly, Safely, and Simply</p>
    <p class="telugu">‡∞™‡±ç‡∞∞‡∞ú‡∞≤‡∞®‡±Å ‡∞∏‡±ç‡∞•‡∞æ‡∞®‡∞ø‡∞ï ‡∞∏‡±á‡∞µ‡∞≤‡∞§‡±ã ‡∞ï‡∞≤‡±Å‡∞™‡±Å‡∞§‡±ã‡∞Ç‡∞¶‡∞ø - ‡∞§‡±ç‡∞µ‡∞∞‡∞ó‡∞æ, ‡∞∏‡±Å‡∞∞‡∞ï‡±ç‡∞∑‡∞ø‡∞§‡∞Ç‡∞ó‡∞æ ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞∏‡∞∞‡∞≥‡∞Ç‡∞ó‡∞æ</p>
    <p style="font-size:1rem;margin:1rem 0">One Tap to Find Electricians, Plumbers, Packers,Tutors, Professionals & More!</p>
    <div class="search-bar">
      <input type="text" id="global-search" placeholder="Search name, service or area..." class="placeholder-english" oninput="debouncedGlobalSearch()">
      <button class="glow-btn" onclick="optimizedGlobalSearch()">Search</button>
    </div>
    <div class="categories" id="categories"></div>
    
    <div class="project-features">
      <div class="feature-card">
        <i class="fas fa-search"></i>
        <h3>Find Vendors</h3>
        <p>Search and connect with verified local service providers</p>
        <p class="telugu">‡∞ß‡±É‡∞µ‡±Ä‡∞ï‡∞∞‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡∞ø‡∞® ‡∞∏‡±ç‡∞•‡∞æ‡∞®‡∞ø‡∞ï ‡∞∏‡±á‡∞µ‡∞æ ‡∞™‡±ç‡∞∞‡∞¶‡∞æ‡∞§‡∞≤‡∞®‡±Å ‡∞ï‡∞®‡±Å‡∞ó‡±ä‡∞®‡∞Ç‡∞°‡∞ø</p>
      </div>
      <div class="feature-card">
        <i class="fas fa-user-plus"></i>
        <h3>Register as Vendor</h3>
        <p>List your services and get more customers</p>
        <p class="telugu">‡∞Æ‡±Ä ‡∞∏‡±á‡∞µ‡∞≤‡∞®‡±Å ‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞ö‡±á‡∞∏‡±Å‡∞ï‡±ä‡∞®‡∞ø ‡∞Æ‡∞∞‡∞ø‡∞®‡±ç‡∞®‡∞ø ‡∞ï‡∞∏‡±ç‡∞ü‡∞Æ‡∞∞‡±ç‡∞≤‡∞®‡±Å ‡∞™‡±ä‡∞Ç‡∞¶‡∞Ç‡∞°‡∞ø</p>
      </div>
      <div class="feature-card">
        <i class="fas fa-phone-alt"></i>
        <h3>Direct Contact</h3>
        <p>Call or WhatsApp vendors directly</p>
        <p class="telugu">‡∞µ‡±Ü‡∞Ç‡∞°‡∞∞‡±ç‡∞≤‡∞®‡±Å ‡∞®‡±á‡∞∞‡±Å‡∞ó‡∞æ ‡∞ï‡∞æ‡∞≤‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø ‡∞≤‡±á‡∞¶‡∞æ ‡∞µ‡∞æ‡∞ü‡±ç‡∞∏‡∞æ‡∞™‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø</p>
      </div>
      <div class="feature-card">
        <i class="fas fa-shield-alt"></i>
        <h3>Simple & Secure</h3>
        <p>Easy to use platform with transparent process</p>
        <p class="telugu">‡∞∏‡±Å‡∞≤‡∞≠‡∞Ç‡∞ó‡∞æ ‡∞â‡∞™‡∞Ø‡±ã‡∞ó‡∞ø‡∞Ç‡∞ö‡∞¶‡∞ó‡∞ø‡∞® ‡∞™‡±ç‡∞≤‡∞æ‡∞ü‡±ç‚Äå‡∞´‡∞æ‡∞∞‡∞Æ‡±ç</p>
      </div>
    </div>
    
    <div class="legal-notice">
      <p><strong>Legal Notice:
<a href="legal.html" style="color: white; text-decoration: none;" onmouseover="this.style.textDecoration='underline'" onmouseout="this.style.textDecoration='none'">Click Here to Read Our Legal Policy</a>
</strong></p>
      <p>Lokonex only connects people ‚Äî we do not take money, manage services, or hold any responsibility for vendor actions or customer issues.</p>
      <p><strong>‡∞ö‡∞ü‡±ç‡∞ü‡∞™‡±Å ‡∞®‡±ã‡∞ü‡±Ä‡∞∏‡±Å:</strong></p>
      <p class="telugu">Lokonex ‡∞ï‡±á‡∞µ‡∞≤‡∞Ç ‡∞ï‡∞∏‡±ç‡∞ü‡∞Æ‡∞∞‡±ç ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞µ‡±Ü‡∞Ç‡∞°‡∞∞‡±ç‚Äå‡∞®‡∞ø ‡∞ï‡∞≤‡±Å‡∞™‡±Å‡∞§‡±Å‡∞Ç‡∞¶‡∞ø ‚Äî ‡∞°‡∞¨‡±ç‡∞¨‡±Å, ‡∞∏‡±á‡∞µ‡∞≤ ‡∞®‡∞æ‡∞£‡±ç‡∞Ø‡∞§, ‡∞≤‡±á‡∞¶‡∞æ ‡∞∏‡∞Æ‡∞∏‡±ç‡∞Ø‡∞≤‡∞™‡±à ‡∞¨‡∞æ‡∞ß‡±ç‡∞Ø‡∞§ ‡∞µ‡∞π‡∞ø‡∞Ç‡∞ö‡∞¶‡±Å.</p>
    </div>
  </div>
</div>

<div id="about" class="page">
  <div class="card">
    <div class="about-hero">
      <h1>About Lokonex</h1>
      <p class="telugu" style="font-size:1.4rem;color:#ffd700">‡∞≤‡±ã‡∞ï‡±ã‡∞®‡±Ü‡∞ï‡±ç‡∞∏‡±ç ‡∞ó‡±Å‡∞∞‡∞ø‡∞Ç‡∞ö‡∞ø</p>
      <p>Connecting with trusted local services since 2025</p>
      <p class="telugu">2025 ‡∞®‡±Å‡∞Ç‡∞°‡∞ø ‡∞µ‡∞ø‡∞∂‡±ç‡∞µ‡∞∏‡∞®‡±Ä‡∞Ø ‡∞∏‡±ç‡∞•‡∞æ‡∞®‡∞ø‡∞ï ‡∞∏‡±á‡∞µ‡∞≤‡∞§‡±ã ‡∞ï‡∞≤‡±Å‡∞™‡±Å‡∞§‡±ã‡∞Ç‡∞¶‡∞ø</p>
    </div>
    
    <div class="about-content">
      <div class="about-section">
        <h2><i class="fas fa-bullseye icon-glow"></i> Our Mission</h2>
        <p>To empower every household in Hanamakonda with instant access to trusted local professionals ‚Äî electricians, tutors, mechanics, and more ‚Äî in one tap. We believe in strengthening local economies by connecting skilled professionals with those who need their services.</p>
        <p class="telugu"> ‡∞™‡±ç‡∞∞‡∞§‡∞ø ‡∞á‡∞Ç‡∞ü‡∞ø‡∞ï‡∞ø ‡∞µ‡∞ø‡∞∂‡±ç‡∞µ‡∞∏‡∞®‡±Ä‡∞Ø ‡∞∏‡±ç‡∞•‡∞æ‡∞®‡∞ø‡∞ï ‡∞®‡∞ø‡∞™‡±Å‡∞£‡±Å‡∞≤‡∞®‡±Å ‡∞í‡∞ï‡±ç‡∞ï ‡∞ü‡±ç‡∞Ø‡∞æ‡∞™‡±ç‚Äå‡∞≤‡±ã ‡∞Ö‡∞Ç‡∞¶‡∞ø‡∞Ç‡∞ö‡∞°‡∞Ç. ‡∞®‡±à‡∞™‡±Å‡∞£‡±ç‡∞Ø‡∞Ç ‡∞ï‡∞≤‡∞ø‡∞ó‡∞ø‡∞® ‡∞®‡∞ø‡∞™‡±Å‡∞£‡±Å‡∞≤‡∞®‡±Å ‡∞µ‡∞æ‡∞∞‡∞ø ‡∞∏‡±á‡∞µ‡∞≤‡±Å ‡∞Ö‡∞µ‡∞∏‡∞∞‡∞Æ‡∞Ø‡±ç‡∞Ø‡±á ‡∞µ‡∞æ‡∞∞‡∞ø‡∞§‡±ã ‡∞ï‡∞≤‡∞™‡∞°‡∞Ç ‡∞¶‡±ç‡∞µ‡∞æ‡∞∞‡∞æ ‡∞∏‡±ç‡∞•‡∞æ‡∞®‡∞ø‡∞ï ‡∞Ü‡∞∞‡±ç‡∞•‡∞ø‡∞ï ‡∞µ‡±ç‡∞Ø‡∞µ‡∞∏‡±ç‡∞•‡∞≤‡∞®‡±Å ‡∞¨‡∞≤‡±ã‡∞™‡±á‡∞§‡∞Ç ‡∞ö‡±á‡∞Ø‡∞°‡∞Ç‡∞™‡±à ‡∞Æ‡∞æ‡∞ï‡±Å ‡∞®‡∞Æ‡±ç‡∞Æ‡∞ï‡∞Ç ‡∞â‡∞Ç‡∞¶‡∞ø.</p>
      </div>
      
      <div class="about-section">
        <h2><i class="fas fa-star icon-glow"></i> What We Offer</h2>
        <p>Lokonex provides a seamless platform for residents to find and connect with verified local service providers. Our platform ensures transparency, ease of use, and direct communication between customers and vendors.</p>
        <p class="telugu">‡∞≤‡±ã‡∞ï‡±ã‡∞®‡±Ü‡∞ï‡±ç‡∞∏‡±ç ‡∞®‡∞ø‡∞µ‡∞æ‡∞∏‡∞ø‡∞§‡±Å‡∞≤‡∞ï‡±Å ‡∞ß‡±É‡∞µ‡±Ä‡∞ï‡∞∞‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡∞ø‡∞® ‡∞∏‡±ç‡∞•‡∞æ‡∞®‡∞ø‡∞ï ‡∞∏‡±á‡∞µ‡∞æ ‡∞™‡±ç‡∞∞‡∞¶‡∞æ‡∞§‡∞≤‡∞®‡±Å ‡∞ï‡∞®‡±Å‡∞ó‡±ä‡∞®‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞µ‡∞æ‡∞∞‡∞ø‡∞§‡±ã ‡∞ï‡∞®‡±Ü‡∞ï‡±ç‡∞ü‡±ç ‡∞Ö‡∞µ‡±ç‡∞µ‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞™‡±ç‡∞≤‡∞æ‡∞ü‡±ç‚Äå‡∞´‡∞æ‡∞∞‡∞Æ‡±ç‚Äå‡∞®‡±Å ‡∞Ö‡∞Ç‡∞¶‡∞ø‡∞∏‡±ç‡∞§‡±Å‡∞Ç‡∞¶‡∞ø. ‡∞Æ‡∞æ ‡∞™‡±ç‡∞≤‡∞æ‡∞ü‡±ç‚Äå‡∞´‡∞æ‡∞∞‡∞Æ‡±ç ‡∞™‡∞æ‡∞∞‡∞¶‡∞∞‡±ç‡∞∂‡∞ï‡∞§, ‡∞â‡∞™‡∞Ø‡±ã‡∞ó‡∞ø‡∞Ç‡∞ö‡∞°‡∞Ç‡∞≤‡±ã ‡∞∏‡±å‡∞≤‡∞≠‡±ç‡∞Ø‡∞Ç ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞ï‡∞∏‡±ç‡∞ü‡∞Æ‡∞∞‡±ç‡∞≤‡±Å ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞µ‡∞ø‡∞ï‡±ç‡∞∞‡±á‡∞§‡∞≤ ‡∞Æ‡∞ß‡±ç‡∞Ø ‡∞®‡±á‡∞∞‡±Å‡∞ó‡∞æ ‡∞ï‡∞Æ‡±ç‡∞Ø‡±Ç‡∞®‡∞ø‡∞ï‡±á‡∞∑‡∞®‡±ç‚Äå‡∞®‡±Å ‡∞®‡∞ø‡∞∞‡±ç‡∞ß‡∞æ‡∞∞‡∞ø‡∞∏‡±ç‡∞§‡±Å‡∞Ç‡∞¶‡∞ø.</p>
        
        <div class="about-highlights">
          <div class="highlight-item">
            <i class="fas fa-gift"></i>
            <h3>First 10 FREE</h3>
            <p class="telugu">‡∞Æ‡±ä‡∞¶‡∞ü‡∞ø 10 ‡∞Æ‡∞Ç‡∞¶‡∞ø ‡∞â‡∞ö‡∞ø‡∞§‡∞Ç</p>
          </div>
          <div class="highlight-item">
            <i class="fas fa-rupee-sign"></i>
            <h3>‚Çπ999 One-Time</h3>
            <p class="telugu">‚Çπ999 ‡∞í‡∞ï‡±ç‡∞ï‡∞∏‡∞æ‡∞∞‡∞ø ‡∞´‡±Ä‡∞ú‡±Å</p>
          </div>
          <div class="highlight-item">
            <i class="fas fa-calendar-alt"></i>
            <h3>1-Year Validity</h3>
            <p class="telugu">1 ‡∞∏‡∞Ç‡∞µ‡∞§‡±ç‡∞∏‡∞∞‡∞Ç ‡∞µ‡∞æ‡∞≤‡∞ø‡∞°‡∞ø‡∞ü‡±Ä</p>
          </div>
          <div class="highlight-item">
            <i class="fas fa-check-circle"></i>
            <h3>Verified Only</h3>
            <p class="telugu">‡∞ß‡±É‡∞µ‡±Ä‡∞ï‡∞∞‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡∞ø‡∞®‡∞µ‡∞ø ‡∞Æ‡∞æ‡∞§‡±ç‡∞∞‡∞Æ‡±á</p>
          </div>
        </div>
      </div>
      
      <div class="about-section">
        <h2><i class="fas fa-tools icon-glow"></i> Service Categories</h2>
        <p>We cover a wide range of services to meet all your local needs. Our service categories include: Electricians, Plumbers, Carpenters, Mechanics, Painters, Teachers/Tutors, Doctors/Clinics, Lawyers/Legal Advisors, Astrologers, Travel Agencies, Salons & Beauty Parlours, Tailors/Boutiques, and many more services to serve the Hanamakonda community.</p>
        <p class="telugu">‡∞Æ‡±Ä ‡∞Ö‡∞®‡±ç‡∞®‡∞ø ‡∞∏‡±ç‡∞•‡∞æ‡∞®‡∞ø‡∞ï ‡∞Ö‡∞µ‡∞∏‡∞∞‡∞æ‡∞≤‡∞®‡±Å ‡∞§‡±Ä‡∞∞‡±ç‡∞ö‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞Æ‡±á‡∞Æ‡±Å ‡∞µ‡∞ø‡∞∏‡±ç‡∞§‡±É‡∞§ ‡∞∂‡±ç‡∞∞‡±á‡∞£‡∞ø ‡∞∏‡±á‡∞µ‡∞≤‡∞®‡±Å ‡∞ï‡∞µ‡∞∞‡±ç ‡∞ö‡±á‡∞∏‡±ç‡∞§‡∞æ‡∞Æ‡±Å. ‡∞Æ‡∞æ ‡∞∏‡±á‡∞µ‡∞æ ‡∞µ‡∞∞‡±ç‡∞ó‡∞æ‡∞≤‡∞≤‡±ã ‡∞á‡∞µ‡∞ø ‡∞â‡∞®‡±ç‡∞®‡∞æ‡∞Ø‡∞ø: ‡∞é‡∞≤‡∞ï‡±ç‡∞ü‡±ç‡∞∞‡±Ä‡∞∑‡∞ø‡∞Ø‡∞®‡±ç‡∞≤‡±Å, ‡∞™‡±ç‡∞≤‡∞Ç‡∞¨‡∞∞‡±ç‡∞≤‡±Å, ‡∞ï‡∞æ‡∞∞‡±ç‡∞™‡±Ü‡∞Ç‡∞ü‡∞∞‡±ç‡∞≤‡±Å, ‡∞Æ‡±Ü‡∞ï‡∞æ‡∞®‡∞ø‡∞ï‡±ç‡∞≤‡±Å, ‡∞™‡±Ü‡∞Ø‡∞ø‡∞Ç‡∞ü‡∞∞‡±ç‡∞≤‡±Å, ‡∞ü‡±Ä‡∞ö‡∞∞‡±ç‡∞≤‡±Å/‡∞ü‡±ç‡∞Ø‡±Ç‡∞ü‡∞∞‡±ç‡∞≤‡±Å, ‡∞°‡∞æ‡∞ï‡±ç‡∞ü‡∞∞‡±ç‡∞≤‡±Å/‡∞ï‡±ç‡∞≤‡∞ø‡∞®‡∞ø‡∞ï‡±ç‡∞≤‡±Å, ‡∞≤‡∞æ‡∞Ø‡∞∞‡±ç‡∞≤‡±Å/‡∞≤‡±Ä‡∞ó‡∞≤‡±ç ‡∞Ö‡∞°‡±ç‡∞µ‡±à‡∞ú‡∞∞‡±ç‡∞≤‡±Å, ‡∞ú‡±ç‡∞Ø‡±ã‡∞§‡∞ø‡∞∑‡±ç‡∞Ø‡±Å‡∞≤‡±Å, ‡∞ü‡±ç‡∞∞‡∞æ‡∞µ‡±Ü‡∞≤‡±ç ‡∞è‡∞ú‡±Ü‡∞®‡±ç‡∞∏‡±Ä‡∞≤‡±Å, ‡∞∏‡±Ü‡∞≤‡±Ç‡∞®‡±ç‡∞≤‡±Å & ‡∞¨‡±ç‡∞Ø‡±Ç‡∞ü‡±Ä ‡∞™‡∞æ‡∞∞‡±ç‡∞≤‡∞∞‡±ç‡∞≤‡±Å, ‡∞ü‡±à‡∞≤‡∞∞‡±ç‡∞≤‡±Å/‡∞¨‡±Ç‡∞ü‡∞ø‡∞ï‡±ç‡∞≤‡±Å ‡∞Æ‡∞∞‡∞ø‡∞Ø‡±Å ‡∞π‡∞®‡∞Æ‡∞ï‡±ä‡∞Ç‡∞° ‡∞∏‡∞Æ‡∞æ‡∞ú‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞∏‡±á‡∞µ‡∞≤‡∞Ç‡∞¶‡∞ø‡∞Ç‡∞ö‡∞°‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞Æ‡∞∞‡∞ø‡∞®‡±ç‡∞®‡∞ø ‡∞∏‡±á‡∞µ‡∞≤‡±Å.</p>
      </div>
      
      <div class="about-section">
        <h2><i class="fas fa-headset icon-glow"></i> Contact Us</h2>
        <p>Have questions or need support? Our team is here to help you get the most out of Lokonex.</p>
        <p class="telugu">‡∞™‡±ç‡∞∞‡∞∂‡±ç‡∞®‡∞≤‡±Å ‡∞â‡∞®‡±ç‡∞®‡∞æ‡∞Ø‡∞æ ‡∞≤‡±á‡∞¶‡∞æ ‡∞Æ‡∞¶‡±ç‡∞¶‡∞§‡±Å ‡∞ï‡∞æ‡∞µ‡∞æ‡∞≤‡∞æ? ‡∞≤‡±ã‡∞ï‡±ã‡∞®‡±Ü‡∞ï‡±ç‡∞∏‡±ç ‡∞®‡±Å‡∞Ç‡∞°‡∞ø ‡∞ó‡∞∞‡∞ø‡∞∑‡±ç‡∞ü ‡∞™‡±ç‡∞∞‡∞Ø‡±ã‡∞ú‡∞®‡∞Ç ‡∞™‡±ä‡∞Ç‡∞¶‡∞°‡∞Ç‡∞≤‡±ã ‡∞Æ‡±Ä‡∞ï‡±Å ‡∞∏‡∞π‡∞æ‡∞Ø‡∞™‡∞°‡∞ü‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞Æ‡∞æ ‡∞¨‡±É‡∞Ç‡∞¶‡∞Ç ‡∞á‡∞ï‡±ç‡∞ï‡∞°‡±á ‡∞â‡∞Ç‡∞¶‡∞ø.</p>
        
        <div class="contact-info">
          <div class="contact-card">
            <h3><i class="fas fa-phone"></i> Call Us</h3>
            <p><a href="tel:8500172644">8500172644</a></p>
          </div>
          <div class="contact-card">
            <h3><i class="fab fa-whatsapp"></i> WhatsApp</h3>
            <p><a href="https://wa.me/918500172644" target="_blank">Chat with Us</a></p>
          </div>
          <div class="contact-card">
            <h3><i class="fas fa-globe"></i> Website</h3>
            <p><a href="https://www.svrcomputers.in" target="_blank">www.svrcomputers.in</a></p>
          </div>
          <div class="contact-card">
            <h3><i class="fas fa-map-marker-alt"></i> Location</h3>
            <p>Julywada Circle, Hanamkonda Telangana</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="vendors" class="page">
  <div class="card">
    <h2 style="text-align:center">Verified Local Vendors</h2>
    <div class="search-bar">
      <input type="text" id="vendor-search" placeholder="Search vendors..." class="placeholder-english" oninput="debouncedVendorSearch()">
      <button class="glow-btn" onclick="optimizedFilterVendors()">Go</button>
    </div>
    <div class="vendor-grid" id="vendor-grid"></div>
  </div>
</div>

<div id="register" class="page">
  <div class="card">
    <h2 style="text-align:center">Join as Vendor</h2>
    <form id="vendor-form">
      <label>Full Name * / ‡∞™‡±Ç‡∞∞‡±ç‡∞§‡∞ø ‡∞™‡±á‡∞∞‡±Å *</label>
      <input type="text" name="name" required placeholder="Enter your full name / ‡∞Æ‡±Ä ‡∞™‡±Ç‡∞∞‡±ç‡∞§‡∞ø ‡∞™‡±á‡∞∞‡±Å ‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø" class="placeholder-english">
      
      <label>Mobile * / ‡∞Æ‡±ä‡∞¨‡±à‡∞≤‡±ç *</label>
      <input type="tel" name="mobile" required placeholder="Enter your mobile number / ‡∞Æ‡±Ä ‡∞Æ‡±ä‡∞¨‡±à‡∞≤‡±ç ‡∞®‡∞Ç‡∞¨‡∞∞‡±ç ‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø" class="placeholder-english">
      
      <label>Service Category * / ‡∞∏‡±á‡∞µ‡∞æ ‡∞µ‡∞∞‡±ç‡∞ó‡∞Ç *</label>
      <select name="service" id="service-select" onchange="toggleCustom(this,'custom-service')" required>
        <option value="">-- Select Service -- / ‡∞∏‡±á‡∞µ‡∞®‡±Å ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø --</option>
      </select>
      
      <input type="text" id="custom-service" name="custom_service" placeholder="Enter your service / ‡∞Æ‡±Ä ‡∞∏‡±á‡∞µ‡∞®‡±Å ‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø" class="placeholder-english">
      
      <label>Area * / ‡∞™‡±ç‡∞∞‡∞æ‡∞Ç‡∞§‡∞Ç *</label>
      <input type="text" name="area" required placeholder="Enter your area / ‡∞Æ‡±Ä ‡∞™‡±ç‡∞∞‡∞æ‡∞Ç‡∞§‡∞Ç ‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø" class="placeholder-english">
      
      <label>Experience (Years) * / ‡∞Ö‡∞®‡±Å‡∞≠‡∞µ‡∞Ç (‡∞∏‡∞Ç‡∞µ‡∞§‡±ç‡∞∏‡∞∞‡∞æ‡∞≤‡±Å) *</label>
      <input type="number" name="exp" min="0" required placeholder="Enter years of experience / ‡∞Ö‡∞®‡±Å‡∞≠‡∞µ‡∞Ç ‡∞∏‡∞Ç‡∞µ‡∞§‡±ç‡∞∏‡∞∞‡∞æ‡∞≤‡±Å ‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø" class="placeholder-english">
      
    <label>Photo (Optional) / ‡∞´‡±ã‡∞ü‡±ã (‡∞ê‡∞ö‡±ç‡∞õ‡∞ø‡∞ï‡∞Ç)</label>
<input type="file" name="photo" accept="image/*">
<p>Please upload a small-size photo below 100 KB. If it is not available, just leave it.</p>
<p>‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø 100 KB ‡∞ï‡∞Ç‡∞ü‡±á ‡∞§‡∞ï‡±ç‡∞ï‡±Å‡∞µ ‡∞∏‡±à‡∞ú‡±ç ‡∞â‡∞®‡±ç‡∞® ‡∞´‡±ã‡∞ü‡±ã‡∞®‡±Å ‡∞Ö‡∞™‡±ç‡∞≤‡±ã‡∞°‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø. ‡∞Ö‡∞¶‡∞ø ‡∞Ö‡∞Ç‡∞¶‡±Å‡∞¨‡∞æ‡∞ü‡±Å‡∞≤‡±ã ‡∞≤‡±á‡∞ï‡∞™‡±ã‡∞§‡±á ‡∞ñ‡∞æ‡∞≥‡±Ä‡∞ó‡∞æ ‡∞µ‡∞¶‡∞ø‡∞≤‡±á‡∞Ø‡∞Ç‡∞°‡∞ø.</p>
  
      <label>Description * / ‡∞µ‡∞ø‡∞µ‡∞∞‡∞£ *</label>
      <textarea name="desc" rows="3" required placeholder="Describe your services / ‡∞Æ‡±Ä ‡∞∏‡±á‡∞µ‡∞≤‡∞®‡±Å ‡∞µ‡∞ø‡∞µ‡∞∞‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø" class="placeholder-english"></textarea>
      
      <button type="submit" class="glow-btn" style="width:100%;padding:1rem;margin-top:1.5rem" id="submit-btn">
        Submit Registration / ‡∞®‡∞Æ‡±ã‡∞¶‡±Å‡∞®‡±Å ‡∞∏‡∞Æ‡∞∞‡±ç‡∞™‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø
      </button>
    </form>
  </div>
</div>

<div id="payment-page" class="page">
  <div class="card">
    <h2 style="text-align:center;color:#ffd700">Complete Payment</h2>
    <p style="font-size:1.1rem">First 50 FREE! You are #<b id="reg-number">51</b></p>
    <p style="font-size:1rem">‚Çπ299 Registration Fee</p>
    <img src="https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=upi://pay?pa=8500172644@ybl&am=299&cu=INR&tn=Lokonex" alt="Pay QR">
    <p style="font-size:1rem;margin:1rem 0"><b>UPI ID:</b> <span style="color:#ffd700">8500172644@ybl</span></p>
    <button class="glow-btn" id="paid-btn" style="width:100%;padding:1rem;font-size:1rem">
      Pls Pay & Submit for Approval
    </button>
    <button class="glow-btn" onclick="show('home')" style="width:100%;margin-top:1rem;background:#666">
      Back to Home
    </button>
  </div>
</div>

<div id="admin" class="page">
  <div class="card">
    <div id="login-box">
      <h2 style="text-align:center">Admin Login</h2>
      <input type="text" id="admin-user" placeholder="Username" style="width:80%;padding:0.8rem;margin:1rem auto;display:block"><br>
      <input type="password" id="admin-pass" placeholder="Password" style="width:80%;padding:0.8rem;margin:1rem auto;display:block"><br>
      <button class="glow-btn" onclick="adminLogin()">Login</button>
    </div>
    <div id="dashboard" style="display:none;overflow-x:auto">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem">
        <h2>Admin Dashboard</h2>
        <button class="glow-btn" onclick="adminLogout()" style="background:#e74c3c">Logout</button>
      </div>
      <p>Free Slots: <b id="free-slots">50</b> | Total: <b id="total-v">0</b></p>
      
      <div style="margin:1rem 0;padding:1rem;background:rgba(255,215,0,0.1);border-radius:12px;border:1px solid rgba(255,215,0,0.3)">
        <h3 style="color:#ffd700;margin-bottom:1rem;text-align:center">
          <i class="fas fa-shield-alt"></i> Data Protection Center
        </h3>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:0.8rem;">
          <button class="glow-btn" onclick="completeOneClickBackup()" style="background:#27ae60">
            <i class="fas fa-download"></i> One-Click Backup
          </button>
          <button class="glow-btn" onclick="oneClickRestore()" style="background:#e67e22">
            <i class="fas fa-upload"></i> One-Click Restore
          </button>
          <button class="glow-btn" onclick="showBackupInfo()" style="background:#3498db">
            <i class="fas fa-info-circle"></i> Backup Info
          </button>
        </div>
      </div>
      
      <div class="category-management">
        <h3>Manage Service Categories</h3>
        <div style="display:flex;gap:0.5rem;margin-bottom:1rem">
          <input type="text" id="new-category" placeholder="New category name" style="flex:1">
          <button class="glow-btn" onclick="addCategory()">Add Category</button>
        </div>
        <div class="category-list" id="category-list"></div>
      </div>
      
      <h3>All Vendors</h3>
      <div style="margin-bottom:1rem">
        <button class="glow-btn" onclick="deleteSelected()" style="background:#e74c3c">Delete Selected</button>
        <button class="glow-btn" onclick="updateSelected()" style="background:#3498db">Update Selected</button>
        <button class="glow-btn" onclick="exportBackup()" style="background:#9b59b6">
          <i class="fas fa-download"></i> Export Backup
        </button>
        <button class="glow-btn" onclick="importBackup()" style="background:#2ecc71">
          <i class="fas fa-upload"></i> Import Backup
        </button>
        <span id="selected-count" style="margin-left:10px;color:#ffd700">0 selected</span>
      </div>
      <input type="file" id="backup-file" accept=".json" style="display:none">
      <table style="width:100%;min-width:600px;border-collapse:collapse">
        <thead>
          <tr>
            <th><input type="checkbox" onclick="toggleAll(this)"></th>
            <th>Name</th>
            <th>Mobile</th>
            <th>Service</th>
            <th>Reg Date & Time</th>
            <th>Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="admin-body"></tbody>
      </table>
      
      <div id="update-form-container" style="display:none"></div>
    </div>
  </div>
</div>

<div id="popup">
  <h2 id="popup-title">Success!</h2>
  <p id="popup-msg">Done.</p>
  <button class="glow-btn" onclick="closePopup()">OK</button>
</div>

<div id="contact-popup">
  <h2>Important Notice</h2>
  <p>Lokonex only connects customers with vendors. We are not responsible for service quality, payments, or any issues that may arise.</p>
  <p class="telugu">‡∞≤‡±ã‡∞ï‡±ã‡∞®‡±Ü‡∞ï‡±ç‡∞∏‡±ç ‡∞ï‡±á‡∞µ‡∞≤‡∞Ç ‡∞ï‡∞∏‡±ç‡∞ü‡∞Æ‡∞∞‡±ç‡∞≤‡∞®‡±Å ‡∞µ‡±Ü‡∞Ç‡∞°‡∞∞‡±ç‡∞≤‡∞§‡±ã ‡∞ï‡∞≤‡±Å‡∞™‡±Å‡∞§‡±Å‡∞Ç‡∞¶‡∞ø. ‡∞∏‡±á‡∞µ ‡∞®‡∞æ‡∞£‡±ç‡∞Ø‡∞§, ‡∞ö‡±Ü‡∞≤‡±ç‡∞≤‡∞ø‡∞Ç‡∞™‡±Å‡∞≤‡±Å ‡∞≤‡±á‡∞¶‡∞æ ‡∞è‡∞µ‡±à‡∞®‡∞æ ‡∞∏‡∞Æ‡∞∏‡±ç‡∞Ø‡∞≤‡∞ï‡±Å ‡∞Æ‡±á‡∞Æ‡±Å ‡∞¨‡∞æ‡∞ß‡±ç‡∞Ø‡∞§ ‡∞µ‡∞π‡∞ø‡∞Ç‡∞ö‡∞Æ‡±Å.</p>
  <button class="glow-btn" onclick="proceedToContact()">I Understand</button>
  <button onclick="closeContactPopup()" style="background:#666;margin-left:0.5rem;margin-top:0.5rem">Cancel</button>
</div>

<footer>
  <div class="footer-content">
    <div class="footer-section">
      <h3>Quick Links</h3>
      <a onclick="show('home')">Home</a>
      <a onclick="show('about')">About</a>
      <a onclick="show('vendors')">Find Vendors</a>
      <a onclick="show('register')">Register as Vendor</a>
      <a href="legal.html" style="color: white; text-decoration: none;" onmouseover="this.style.textDecoration='underline'" onmouseout="this.style.textDecoration='none'">Legal Policy</a>
    </div>
    
    <div class="footer-section">
      <h3>Contact Info</h3>
      <p><i class="fas fa-phone"></i> <span class="contact-number">8500172644</span></p>
      <p><i class="fab fa-whatsapp"></i> <span class="contact-number">8500172644</span></p>
      <p><i class="fas fa-map-marker-alt"></i> Julywada Circle, <br> Hanamkonda, Telangana</p>
    </div>
    
    <div class="footer-section">
      <h3>Service Categories</h3>
      <p>Electricians ‚Ä¢ Plumbers ‚Ä¢ Tutors</p>
      <p>Mechanics ‚Ä¢ Painters ‚Ä¢ Doctors</p>
      <p>Salons ‚Ä¢ Tailors ‚Ä¢ And More...</p>
    </div>
    
    <div class="footer-section">
      <h3>Need Help?</h3>
      <p>Chat with us on WhatsApp for quick support</p>
      <p class="telugu">‡∞§‡±ç‡∞µ‡∞∞‡∞ø‡∞§ ‡∞∏‡∞π‡∞æ‡∞Ø‡∞Ç ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞Æ‡∞æ‡∞§‡±ã WhatsApp‡∞≤‡±ã ‡∞ö‡∞æ‡∞ü‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø</p>
      <button class="whatsapp-support-btn" onclick="openSupportWhatsApp()">
        <i class="fab fa-whatsapp"></i> Chat with Support
      </button>
    </div>
    
    <!-- ADD BACK THE SHARE APP SECTION -->
    <div class="footer-section">
      <h3>Share This App</h3>
      <p>Help others discover Lokonex by sharing this app</p>
      <p class="telugu">‡∞≤‡±ã‡∞ï‡±ã‡∞®‡±Ü‡∞ï‡±ç‡∞∏‡±ç ‡∞Æ‡∞∞‡∞ø‡∞ï‡±ä‡∞Ç‡∞¶‡∞∞‡∞ø‡∞ï‡∞ø ‡∞∑‡±á‡∞∞‡±ç ‡∞ö‡±á‡∞∏‡∞ø, ‡∞µ‡∞æ‡∞∞‡±Å ‡∞ï‡±Ç‡∞°‡∞æ ‡∞à ‡∞Ö‡∞¶‡±ç‡∞≠‡±Å‡∞§‡∞Æ‡±à‡∞® ‡∞Ø‡∞æ‡∞™‡±ç‚Äå‡∞®‡±Å ‡∞â‡∞™‡∞Ø‡±ã‡∞ó‡∞ø‡∞Ç‡∞ö‡±á‡∞Ç‡∞¶‡±Å‡∞ï‡±Å ‡∞∏‡∞π‡∞æ‡∞Ø‡∞Ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø</p>
      <button class="share-btn" onclick="shareApp()">
        <i class="fas fa-share-alt"></i> Share with Others
      </button>
    </div>
  </div>
  
  <div class="copyright">
    <p>¬© 2025 Lokonex . All rights reserved. <br> Designed and Developed by SVR Computers</p>
  </div>
</footer>

<!-- Add Firebase Scripts -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
// ==================== FIREBASE CONFIGURATION WITH OPTIMIZATIONS ====================
const FIREBASE_ENABLED = true;

// Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyB8WfD7DneS5nQXOLxB6c_D-n9aFgttr_w",
  authDomain: "local-market2025.firebaseapp.com",
  databaseURL: "https://local-market2025-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "local-market2025",
  storageBucket: "local-market2025.firebasestorage.app",
  messagingSenderId: "1092213380873",
  appId: "1:1092213380873:web:d89bebc1bd8000cba525d8",
  measurementId: "G-HMZXGT78G0"
};

// Initialize Firebase with optimizations
let firebaseApp;
let database;
let isFirebaseConnected = false;

function initializeFirebaseWithRetry(retryCount = 0) {
  if (FIREBASE_ENABLED && typeof firebase !== 'undefined') {
    try {
      firebaseApp = firebase.initializeApp(firebaseConfig);
      database = firebase.database();
      isFirebaseConnected = true;
      console.log("üî• Firebase initialized successfully");
      
      // Set connection quality to reduce bandwidth
      if (database && database.goOnline) {
        database.goOnline(); // Ensure we're online but with optimizations
      }
      
      setupOptimizedRealtimeSync();
      
    } catch (error) {
      console.error("Firebase initialization failed, retrying...", error);
      
      if (retryCount < 2) { // Reduced retry attempts
        setTimeout(() => initializeFirebaseWithRetry(retryCount + 1), 2000);
      } else {
        console.error("üî• Firebase failed after retries, using localStorage only");
        isFirebaseConnected = false;
        showFirebaseWarning();
      }
    }
  }
}

function showFirebaseWarning() {
  console.log("‚ö†Ô∏è Firebase not available, using localStorage only");
}

// ==================== OPTIMIZED FIREBASE SYNC ====================

function setupOptimizedRealtimeSync() {
  if (!FIREBASE_ENABLED || !database || !isFirebaseConnected) return;

  try {
    // Use once() instead of on() for initial load to reduce reads
    database.ref('vendors').once('value')
      .then((snapshot) => {
        const firebaseVendors = snapshot.val();
        if (firebaseVendors && Array.isArray(firebaseVendors)) {
          if (JSON.stringify(vendors) !== JSON.stringify(firebaseVendors)) {
            vendors = firebaseVendors;
            
            console.log("üì± Loaded vendors from Firebase:", vendors.length);
            showVendors();
            updateFreeSlots();
          }
        }
      })
      .catch((error) => {
        console.error("Firebase load error:", error);
        isFirebaseConnected = false;
      });

    console.log("üîÑ Optimized sync activated");
  } catch (error) {
    console.error("Real-time sync error:", error);
    isFirebaseConnected = false;
  }
}

// Optimized Firebase save with batching
let firebaseSaveQueue = [];
let isSavingToFirebase = false;

// ==================== EXISTING PHOTOS MIGRATION ====================
async function migrateExistingPhotos() {
    console.log("üîÑ Migrating existing photos to compressed versions...");
    
    let migratedCount = 0;
    const totalVendors = vendors.length;
    
    for (let i = 0; i < totalVendors; i++) {
        const vendor = vendors[i];
        
        // Check if photo is large base64 (not default and not already compressed)
        if (vendor.photo && 
            vendor.photo.startsWith('data:image/') && 
            vendor.photo.length > 5000 && // Large base64 (more than 5KB)
            !vendor.photo.includes('80x80') && // Not already compressed
            vendor.photo !== getDefaultPhoto()) {
            
            try {
                console.log(`üîß Compressing existing photo for: ${vendor.name}`);
                const compressedPhoto = await compressImageExtremely(vendor.photo);
                vendor.photo = compressedPhoto;
                migratedCount++;
                
                console.log(`‚úÖ Compressed photo ${i+1}/${totalVendors}: ${vendor.name}`);
                
                // Small delay to prevent blocking
                await new Promise(resolve => setTimeout(resolve, 50));
            } catch (error) {
                console.error(`‚ùå Failed to compress photo for ${vendor.name}:`, error);
            }
        }
    }
    
    if (migratedCount > 0) {
        await saveVendorsToFirebaseOptimized();
        console.log(`‚úÖ Successfully migrated ${migratedCount} photos to compressed versions`);
        
        // Show success message
        if (typeof popup === 'function') {
            popup('Photos Optimized!', `${migratedCount} existing photos have been optimized to save data! Your app will now use 70% less data.`);
        }
    } else {
        console.log("‚ÑπÔ∏è No photos needed migration - all photos are already optimized");
        if (typeof popup === 'function') {
            popup('No Changes Needed', 'All photos are already optimized!');
        }
    }
    
    return migratedCount;
}

// Add migration button to admin panel
function addMigrationButton() {
    const dashboard = document.getElementById('dashboard');
    if (dashboard) {
        // Check if button already exists
        if (document.getElementById('migration-btn')) return;
        
        const migrationBtn = document.createElement('button');
        migrationBtn.id = 'migration-btn';
        migrationBtn.className = 'glow-btn';
        migrationBtn.style.background = '#9b59b6';
        migrationBtn.style.margin = '0.5rem';
        migrationBtn.innerHTML = '<i class="fas fa-compress"></i> Optimize Existing Photos';
        migrationBtn.onclick = startPhotoMigration;
        
        // Add button after the existing buttons
        const buttonContainer = dashboard.querySelector('.category-management');
        if (buttonContainer) {
            buttonContainer.parentNode.insertBefore(migrationBtn, buttonContainer);
        } else {
            dashboard.querySelector('h2').after(migrationBtn);
        }
    }
}

async function startPhotoMigration() {
    const result = await migrateExistingPhotos();
    showDashboard(); // Refresh admin view
}

// Auto-migrate on app load (optional)
function startAutoMigration() {
    setTimeout(async () => {
        const migratedCount = await migrateExistingPhotos();
        if (migratedCount > 0) {
            console.log(`üîÑ Auto-migrated ${migratedCount} photos`);
        }
    }, 8000); // Wait 8 seconds after page load
}

// ==================== FIREBASE MONITORING ====================
function showFirebaseStats() {
  console.log("=== üî• FIREBASE OPTIMIZATION STATS ===");
  console.log(`Total Vendors: ${vendors.length}`);
  console.log(`Save Queue: ${firebaseSaveQueue.length} pending`);
  console.log(`Currently Saving: ${isSavingToFirebase}`);
  console.log(`Firebase Connected: ${isFirebaseConnected}`);
  console.log("=====================================");
}
// ==================== END MONITORING ====================

async function saveVendorsToFirebaseOptimized() {
  if (!FIREBASE_ENABLED || !database || !isFirebaseConnected) {
    console.log("Firebase not available, using localStorage only");
    return;
  }

  // If already saving, queue the request
  if (isSavingToFirebase) {
    firebaseSaveQueue.push(Date.now());
    return;
  }

  isSavingToFirebase = true;

  try {
    // Use set() instead of update() for better performance
    await database.ref('vendors').set(vendors);
    console.log("üíæ Vendors saved to Firebase (optimized):", vendors.length);
    
    // Clear queue after successful save
    firebaseSaveQueue = [];
    
  } catch (error) {
    console.error("Firebase save error:", error);
    isFirebaseConnected = false;
  } finally {
    isSavingToFirebase = false;
    
    // Process any queued saves
    if (firebaseSaveQueue.length > 0) {
      setTimeout(saveVendorsToFirebaseOptimized, 1000); // Throttle saves
    }
  }
}

// ==================== CORE APPLICATION ====================
const CACHE_KEYS = {
  VENDORS: 'vendors_v3',
  CATEGORIES: 'categories_v2',
  TIMESTAMP: 'data_timestamp'
};

// FIXED: Added "Others" category to the array
let CATEGORIES = JSON.parse(localStorage.getItem(CACHE_KEYS.CATEGORIES)) || [
  "Electricians", "Plumbers", "Carpenters", "Mechanics", "Painters", 
  "Teachers / Tutors", "Doctors / Clinics", "Lawyers / Legal Advisors", 
  "Astrologers", "Travel Agencies", "Salons & Beauty Parlours", 
  "Tailors / Boutiques", "Others"
];


function debugCategories() {
  console.log("Categories:", CATEGORIES);
  console.log("Categories element:", document.getElementById('categories'));
  console.log("Categories HTML:", document.getElementById('categories').innerHTML);
}
setTimeout(debugCategories, 1000);
let vendors = JSON.parse(localStorage.getItem('vendors_v2')) || [];
let tempVendor = null;
let contactAction = null;
let searchTimeout;

// ==================== AUTO-UPDATE FUNCTIONALITY ====================
// ==================== AUTO-UPDATE FUNCTIONALITY ====================
const APP_VERSION = '1.3.0'; // Update this when you make changes

function checkForUpdates() {
  const storedVersion = localStorage.getItem('app_version');
  
  if (storedVersion !== APP_VERSION) {
    console.log(`üîÑ App update detected: ${storedVersion} -> ${APP_VERSION}`);
    
    // Clear all caches and reload
    clearAllCaches().then(() => {
      // Update stored version
      localStorage.setItem('app_version', APP_VERSION);
      
      // Show update notification
      showUpdateNotification();
    });
  }
}

function clearAllCaches() {
  return new Promise((resolve) => {
    // Clear service worker caches
    if ('caches' in window) {
      caches.keys().then(function(cacheNames) {
        const deletePromises = cacheNames.map(function(cacheName) {
          console.log(`üóëÔ∏è Deleting cache: ${cacheName}`);
          return caches.delete(cacheName);
        });
        Promise.all(deletePromises).then(() => {
          console.log('‚úÖ All caches cleared');
          resolve();
        });
      }).catch(() => resolve());
    } else {
      resolve();
    }
  });
}

function showUpdateNotification() {
  const updateNotification = document.createElement('div');
  updateNotification.id = 'update-notification';
  updateNotification.style.cssText = `
    position: fixed;
    top: 70px;
    right: 15px;
    background: linear-gradient(45deg, #ffd700, #ff8c00);
    color: #000;
    padding: 12px 16px;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(255, 215, 0, 0.6);
    z-index: 9999;
    font-weight: 600;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 8px;
    max-width: 300px;
    animation: slideIn 0.5s ease-out;
  `;
  
  updateNotification.innerHTML = `
    <i class="fas fa-sync-alt"></i>
    <span>App Updated to v${APP_VERSION}! Refresh to see changes</span>
    <button onclick="forceRefreshApp()" style="
      background: #000;
      color: #ffd700;
      border: none;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 0.8rem;
      cursor: pointer;
      margin-left: 8px;
    ">Refresh Now</button>
  `;
  
  document.body.appendChild(updateNotification);
  
  // Auto-remove after 15 seconds
  setTimeout(() => {
    if (updateNotification.parentNode) {
      updateNotification.remove();
    }
  }, 15000);
}

function forceRefreshApp() {
  // Clear all storage except vendors data
  const vendorsBackup = localStorage.getItem('vendors_v2');
  const categoriesBackup = localStorage.getItem('categories_v2');
  
  localStorage.clear();
  
  // Restore important data
  if (vendorsBackup) localStorage.setItem('vendors_v2', vendorsBackup);
  if (categoriesBackup) localStorage.setItem('categories_v2', categoriesBackup);
  localStorage.setItem('app_version', APP_VERSION);
  
  // Force reload
  window.location.reload(true);
}

// Service Worker Registration for PWA updates
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('/sw.js').then(function(registration) {
      console.log('SW registered: ', registration);
      
      // Check for service worker updates
      registration.addEventListener('updatefound', () => {
        const newWorker = registration.installing;
        console.log('SW update found!');
        
        newWorker.addEventListener('statechange', () => {
          if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
            console.log('New content is available; please refresh.');
            showServiceWorkerUpdate();
          }
        });
      });
    }).catch(function(registrationError) {
      console.log('SW registration failed: ', registrationError);
    });
    
    // Check for any waiting service workers
    navigator.serviceWorker.ready.then(registration => {
      if (registration.waiting) {
        showServiceWorkerUpdate();
      }
    });
  });
}

function showServiceWorkerUpdate() {
  const swUpdateNotification = document.createElement('div');
  swUpdateNotification.id = 'sw-update-notification';
  swUpdateNotification.style.cssText = `
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(45deg, #25d366, #128C7E);
    color: white;
    padding: 12px 20px;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(37, 211, 102, 0.6);
    z-index: 9999;
    font-weight: 600;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 8px;
    max-width: 90%;
    text-align: center;
  `;
  
  swUpdateNotification.innerHTML = `
    <i class="fas fa-sync-alt"></i>
    <span>New version available!</span>
    <button onclick="updateServiceWorker()" style="
      background: #fff;
      color: #25d366;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 0.8rem;
      cursor: pointer;
      margin-left: 8px;
      font-weight: 600;
    ">Update Now</button>
  `;
  
  document.body.appendChild(swUpdateNotification);
}

function updateServiceWorker() {
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.ready.then(registration => {
      registration.waiting.postMessage({type: 'SKIP_WAITING'});
      window.location.reload();
    });
  }
}

// ==================== IMAGE COMPRESSION FUNCTIONS ====================
function compressImageExtremely(base64Image) {
    return new Promise((resolve) => {
        const img = new Image();
        img.onload = function() {
            const canvas = document.createElement('canvas');
            canvas.width = 80;
            canvas.height = 80;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, 80, 80);
            const compressedBase64 = canvas.toDataURL('image/jpeg', 0.3);
            console.log("üì∏ Image compressed to 80x80 with 30% quality");
            resolve(compressedBase64);
        };
        img.onerror = () => resolve(base64Image);
        img.src = base64Image;
    });
}

function getDefaultPhoto() {
    return 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHZpZXdCb3g9IjAgMCA4MCA4MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSI0MCIgY3k9IjQwIiByPSIzMCIgZmlsbD0iI2ZmZDcwMCIvPjxjaXJjbGUgY3g9IjQwIiBjeT0iMzAiIHI9IjEwIiBmaWxsPSIjMjAzYTQzIi8+PHBhdGggZD0iTTI1IDU1VjQ4QzI1IDQwIDMyIDM1IDQwIDM1QzQ4IDM1IDU1IDQwIDU1IDQ4VjU1IiBzdHJva2U9IiMyMDNhNDMiIHN0cm9rZS13aWR0aD0iMiIvPjwvc3ZnPg==';
}

// ==================== OPTIMIZED VENDOR SAVE ====================
async function saveVendor(photoData, f, isFree) {
    // Use compressed default photo
    let finalPhoto = getDefaultPhoto();
    
    // Compress user photo if provided
    if (photoData && photoData.startsWith('data:image/')) {
        try {
            console.log("üîß Compressing user photo...");
            finalPhoto = await compressImageExtremely(photoData);
            console.log("‚úÖ Photo compressed successfully");
        } catch (error) {
            console.error("‚ùå Compression failed, using default:", error);
            finalPhoto = getDefaultPhoto();
        }
    }

    const vendor = {
        id: Date.now(),
        name: f.name.value.trim(),
        mobile: f.mobile.value.trim(),
        service: f.service.value === 'Others' ? f.custom_service.value.trim() : f.service.value,
        location: f.area.value.trim(),
        experience: f.exp.value,
        photo: finalPhoto, // Now compressed image
        description: f.desc.value.trim(),
        paid: !isFree,
        approved: false,
        regDate: new Date().toLocaleDateString('en-IN'),
        regDateTime: new Date().toLocaleString('en-IN'),
        deviceId: getDeviceId(),
        timestamp: Date.now()
    };

    vendors.push(vendor);
    
    
    // Use optimized Firebase save
    await saveVendorsToFirebaseOptimized();

    if (isFree) {
        popup('Registration Submitted!', 'Your registration has been submitted for admin approval. You will be visible to customers once approved.');
        document.getElementById('vendor-form').reset();
        show('home');
    } else {
        document.getElementById('reg-number').textContent = vendors.filter(v => v.approved).length + 1;
        show('payment-page');
    }
    
    updateFreeSlots();
}

function saveV() { 
  if (FIREBASE_ENABLED) {
    saveVendorsToFirebaseOptimized();
  }
}


// ==================== REMAINING FUNCTIONS (SAME AS BEFORE) ====================

function getDeviceId() {
  let deviceId = localStorage.getItem('device_id');
  if (!deviceId) {
    deviceId = 'device_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    localStorage.setItem('device_id', deviceId);
  }
  return deviceId;
}

function updateDateTime() {
  const now = new Date();
  const options = { 
    weekday: 'long', 
    year: 'numeric', 
    month: 'long', 
    day: 'numeric',
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit'
  };
  document.getElementById('datetime').textContent = now.toLocaleDateString('en-IN', options);
}
setInterval(updateDateTime, 1000);
updateDateTime();

function show(p) {
  localStorage.setItem('currentPage', p);
  document.querySelectorAll('.page').forEach(x => x.classList.remove('active'));
  document.getElementById(p).classList.add('active');
  window.scrollTo({ top: 0, behavior: 'smooth' });
  
  if (p === 'vendors') {
    setTimeout(() => {
      if (typeof showVendors === 'function') {
        showVendors();
      }
    }, 200);
  }
  if (p === 'admin') showDashboard();
  if (p === 'register') document.getElementById('vendor-form').reset();
}

function popup(t, m) {
  document.getElementById('popup-title').innerText = t;
  document.getElementById('popup-msg').innerText = m;
  document.getElementById('popup').classList.add('show');
}

function closePopup() { 
  document.getElementById('popup').classList.remove('show'); 
}

// FIXED: Updated categories display to include "Others"
function updateCategoriesDisplay() {
  document.getElementById('categories').innerHTML = CATEGORIES.map(c => 
    `<div class="category-btn" onclick="filterByCategory('${c}')">${c}</div>`
  ).join('');
  
  const sel = document.getElementById('service-select');
  sel.innerHTML = '<option value="">-- Select Service -- / ‡∞∏‡±á‡∞µ‡∞®‡±Å ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø --</option>' + 
    CATEGORIES.map(c => `<option value="${c}">${c}</option>`).join('') + 


  updateAdminCategories();
}

function updateAdminCategories() {
  const categoryList = document.getElementById('category-list');
  if (categoryList) {
    categoryList.innerHTML = CATEGORIES.map(c => 
      `<div class="category-item">
        ${c}
        <button onclick="deleteCategory('${c}')">√ó</button>
      </div>`
    ).join('');
  }
}

function updateFreeSlots() {
  const free = 50 - vendors.filter(v => v.approved).length;
  document.getElementById('free-slots').textContent = Math.max(0, free);
}

function toggleCustom(sel, id) {
  document.getElementById(id).style.display = sel.value === 'Others' ? 'block' : 'none';
}

function isExpired(d) {
  const [dd,mm,yy] = d.split('/');
  const reg = new Date(yy, mm-1, dd);
  const exp = new Date(reg); exp.setFullYear(reg.getFullYear() + 1);
  return new Date() > exp;
}

function contactVendor(action, mobile) {
  contactAction = {action, mobile};
  document.getElementById('contact-popup').classList.add('show');
}

function proceedToContact() {
  if (contactAction) {
    if (contactAction.action === 'call') {
      location.href = `tel:${contactAction.mobile}`;
    } else if (contactAction.action === 'whatsapp') {
      window.open(`https://wa.me/91${contactAction.mobile}`);
    }
  }
  closeContactPopup();
}

function closeContactPopup() {
  document.getElementById('contact-popup').classList.remove('show');
  contactAction = null;
}

// NEW: WhatsApp Support Function
function openSupportWhatsApp() {
  const message = "Hello, I need help with Lokonex app...";
  window.open(`https://wa.me/918500172644?text=${encodeURIComponent(message)}`);
}

// FIXED: Improved form submission with better error handling
document.getElementById('vendor-form').addEventListener('submit', async function(e) {
  e.preventDefault();
  const f = this.elements;
  
  // Basic validation first
  if (!validateForm(f)) return;
  
  // Disable submit button to prevent double submission
  const submitBtn = document.getElementById('submit-btn');
  const originalText = submitBtn.innerHTML;
  submitBtn.innerHTML = '<span class="loading-spinner"></span> Processing...';
  submitBtn.disabled = true;
  
  try {
    const approvedCount = vendors.filter(v => v.approved).length;
    const isFree = approvedCount < 50;
    const photoFile = f.photo.files[0];
    
    let photoData = getDefaultPhoto();
    
    if (photoFile) {
        console.log("üìÅ User uploaded photo, converting to base64...");
        // Convert file to base64 first
        photoData = await new Promise((resolve) => {
            const reader = new FileReader();
            reader.onload = (e) => resolve(e.target.result);
            reader.onerror = () => resolve(getDefaultPhoto());
            reader.readAsDataURL(photoFile);
        });
    }
    
    await saveVendor(photoData, f, isFree);
    
  } catch (error) {
    console.error('Form submission error:', error);
    popup('Registration Issue', 'Please try again after some time. If problem continues, contact support at 8500172644');
  } finally {
    submitBtn.innerHTML = originalText;
    submitBtn.disabled = false;
  }
});

document.getElementById('paid-btn').onclick = () => {
  const latestVendor = vendors
    .filter(v => !v.approved)
    .sort((a, b) => b.id - a.id)[0];
  
  if (latestVendor) {
    popup('Thank You!', 'Your payment has been received. Admin will approve your registration soon.');
    show('home');
  } else {
    popup('Error', 'No pending registration found.');
  }
};

function showVendors(filteredVendors = null) {
  const grid = document.getElementById('vendor-grid');
  if (!grid) return;
  
  let approvedVendors = filteredVendors || vendors.filter(v => v.approved && !isExpired(v.regDate));
  
  console.log("üîÑ Displaying vendors:", approvedVendors.length);
  
  if (approvedVendors.length === 0) {
    grid.innerHTML = '<p style="text-align:center;grid-column:1/-1;padding:2rem">No vendors found</p>';
    return;
  }
  
  const defaultPhoto = getDefaultPhoto();
  
  grid.innerHTML = approvedVendors.map(v => `
    <div class="vendor-box" data-id="${v.id}">
      <div class="vendor-header">
        <img src="${v.photo || defaultPhoto}" 
             alt="${v.name}" 
             class="vendor-img">
        <div class="vendor-info">
          <h3>${v.name}</h3>
          <p style="color:#ffd700;font-weight:500">${v.service}</p>
        </div>
      </div>
      <div class="vendor-details">
        <div class="vendor-detail">
          <i class="fas fa-phone"></i>
          <span>${v.mobile}</span>
        </div>
        <div class="vendor-detail">
          <i class="fas fa-map-marker-alt"></i>
          <span>${v.location}</span>
        </div>
        <div class="vendor-detail">
          <i class="fas fa-briefcase"></i>
          <span>${v.experience} years experience</span>
        </div>
        <div class="vendor-detail">
          <i class="fas fa-info-circle"></i>
          <span>${v.description}</span>
        </div>
      </div>
      <div class="vendor-actions">
        <button class="glow-btn call-btn" onclick="contactVendor('call', '${v.mobile}')">
          <i class="fas fa-phone"></i> Call
        </button>
        <button class="glow-btn whatsapp-btn" onclick="contactVendor('whatsapp', '${v.mobile}')">
          <i class="fab fa-whatsapp"></i> WhatsApp
        </button>
        <!-- ‚úÖ EDIT BUTTON ADDED -->
        <button class="glow-btn edit-btn" onclick="showEditForm(${v.id})">
          <i class="fas fa-edit"></i> Edit
        </button>
      </div>
    </div>
  `).join('');
}

function showEditForm(vendorId) {
    const vendor = vendors.find(v => v.id === vendorId);
    if (!vendor) return;
    
    const vendorBox = document.querySelector(`.vendor-box[data-id="${vendorId}"]`);
    if (!vendorBox) return;
    
    const editForm = document.createElement('div');
    editForm.className = 'edit-form';
    editForm.innerHTML = `
        <h3>Edit Your Details</h3>
        <input type="text" id="edit-name" value="${vendor.name}" placeholder="Full Name">
        <input type="tel" id="edit-mobile" value="${vendor.mobile}" placeholder="Mobile">
        <select id="edit-service">
            ${CATEGORIES.map(c => `<option value="${c}" ${c === vendor.service ? 'selected' : ''}>${c}</option>`).join('')}
            <option value="Others" ${!CATEGORIES.includes(vendor.service) ? 'selected' : ''}>Others</option>
        </select>
        <input type="text" id="edit-custom-service" value="${!CATEGORIES.includes(vendor.service) ? vendor.service : ''}" placeholder="Custom Service" style="${CATEGORIES.includes(vendor.service) ? 'display:none' : ''}">
        <input type="text" id="edit-location" value="${vendor.location}" placeholder="Area">
        <input type="number" id="edit-experience" value="${vendor.experience}" placeholder="Experience (Years)">
        
        <!-- ‚úÖ PHOTO UPLOAD SECTION ADDED -->
        <div style="margin:1rem 0;padding:1rem;background:rgba(255,255,255,0.05);border-radius:12px;">
            <label style="color:#ffd700;margin-bottom:0.5rem;display:block;">
                <i class="fas fa-camera"></i> Update Photo (Optional)
            </label>
            <div style="display:flex;align-items:center;gap:1rem;margin-bottom:1rem;">
                <img src="${vendor.photo}" alt="Current Photo" style="width:60px;height:60px;border-radius:50%;border:2px solid #ffd700;">
                <div>
                    <p style="font-size:0.8rem;margin:0;">Current Photo</p>
                    <p style="font-size:0.7rem;color:#ccc;margin:0;">Click below to change</p>
                </div>
            </div>
            <input type="file" id="edit-photo" accept="image/*" style="width:100%;padding:0.5rem;">
            <p style="font-size:0.7rem;color:#ffd700;margin-top:0.5rem;">
                <i class="fas fa-info-circle"></i> New photo will be automatically compressed
            </p>
        </div>
        
        <textarea id="edit-description" placeholder="Description">${vendor.description}</textarea>
        <div class="form-actions">
            <button class="glow-btn" onclick="saveVendorEdit(${vendorId})">
                <i class="fas fa-save"></i> Save Changes
            </button>
            <button class="glow-btn" onclick="cancelEdit(${vendorId})" style="background:#666">
                <i class="fas fa-times"></i> Cancel
            </button>
        </div>
    `;
    
    vendorBox.style.display = 'none';
    vendorBox.parentNode.insertBefore(editForm, vendorBox.nextSibling);
    
    document.getElementById('edit-service').addEventListener('change', function() {
        document.getElementById('edit-custom-service').style.display = 
            this.value === 'Others' ? 'block' : 'none';
    });
}
async function saveVendorEdit(vendorId) {
    const vendorIndex = vendors.findIndex(v => v.id === vendorId);
    if (vendorIndex === -1) return;
    
    const serviceValue = document.getElementById('edit-service').value;
    const photoFile = document.getElementById('edit-photo').files[0];
    
    // Get existing vendor data
    const updatedVendor = {
        ...vendors[vendorIndex],
        name: document.getElementById('edit-name').value.trim(),
        mobile: document.getElementById('edit-mobile').value.trim(),
        service: serviceValue === 'Others' 
            ? document.getElementById('edit-custom-service').value.trim() 
            : serviceValue,
        location: document.getElementById('edit-location').value.trim(),
        experience: document.getElementById('edit-experience').value,
        description: document.getElementById('edit-description').value.trim(),
        updateDate: new Date().toLocaleString('en-IN')
    };
    
    // Handle photo update if new photo is selected
    if (photoFile) {
        try {
            console.log("üì∏ Processing new photo for vendor...");
            
            // Convert file to base64 first
            const photoData = await new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = () => resolve(updatedVendor.photo); // Keep old photo if error
                reader.readAsDataURL(photoFile);
            });
            
            // Compress the new photo
            const compressedPhoto = await compressImageExtremely(photoData);
            updatedVendor.photo = compressedPhoto;
            
            console.log("‚úÖ Vendor photo updated and compressed");
        } catch (error) {
            console.error("‚ùå Photo update failed:", error);
            // Keep the existing photo if compression fails
        }
    }
    
    // Update the vendor in the array
    vendors[vendorIndex] = updatedVendor;
    
    // Save to storage and Firebase
    await saveVendorsToFirebaseOptimized();
    
    popup('Success', 'Your details have been updated successfully!');
    showVendors();
}

function cancelEdit(vendorId) {
  const vendorBox = document.querySelector(`.vendor-box[data-id="${vendorId}"]`);
  const editForm = vendorBox.nextSibling;
  
  if (editForm && editForm.classList.contains('edit-form')) {
    editForm.remove();
  }
  
  vendorBox.style.display = 'block';
}

// FIXED: Improved category filtering
function filterByCategory(c) {
  show('vendors');
  
  // Get approved and non-expired vendors
  let filtered = vendors.filter(v => v.approved && !isExpired(v.regDate));
  
  if (c === 'Others') {
    // Show vendors with services not in predefined categories (excluding "Others")
    const mainCategories = CATEGORIES.filter(cat => cat !== 'Others');
    filtered = filtered.filter(v => !mainCategories.includes(v.service));
  } else {
    // Show vendors from the selected category
    filtered = filtered.filter(v => v.service === c);
  }
  
  showVendors(filtered);
  
  // Show message if no vendors found
  if (filtered.length === 0) {
    const grid = document.getElementById('vendor-grid');
    grid.innerHTML = '<p style="text-align:center;grid-column:1/-1;padding:2rem;color:#ffd700">No vendors found in ' + c + ' category</p>';
  }
}

// FIXED: Improved search functionality with auto-search
function debouncedGlobalSearch() {
  clearTimeout(searchTimeout);
  searchTimeout = setTimeout(() => {
    optimizedGlobalSearch();
  }, 500);
}

function debouncedVendorSearch() {
  clearTimeout(searchTimeout);
  searchTimeout = setTimeout(() => {
    optimizedFilterVendors();
  }, 500);
}

function optimizedGlobalSearch() {
  const q = document.getElementById('global-search').value.toLowerCase().trim();
  
  if (q.length < 2) {
    showVendors();
    return;
  }
  
  const results = vendors.filter(v => v.approved && !isExpired(v.regDate) && 
    (v.name.toLowerCase().includes(q) || 
     v.service.toLowerCase().includes(q) || 
     v.location.toLowerCase().includes(q) ||
     v.description.toLowerCase().includes(q)));
  
  show('vendors'); 
  showVendors(results);
}

function optimizedFilterVendors() {
  const q = document.getElementById('vendor-search').value.toLowerCase().trim();
  
  if (q.length < 2) {
    showVendors();
    return;
  }
  
  const results = vendors.filter(v => v.approved && !isExpired(v.regDate) && 
    (v.name.toLowerCase().includes(q) || 
     v.service.toLowerCase().includes(q) || 
     v.location.toLowerCase().includes(q) ||
     v.description.toLowerCase().includes(q)));
  
  showVendors(results);
}

// ==================== FIXED ADMIN LOGIN (REMOVED POPUP) ====================
function adminLogin() {
  const user = document.getElementById('admin-user').value.trim();
  const pass = document.getElementById('admin-pass').value.trim();
  if (user === "svr" && pass === "2109") {
    adminSession = true;
    document.getElementById('login-box').style.display = "none";
    document.getElementById('dashboard').style.display = "block";
    showDashboard();
    // REMOVED: popup('Login Success', 'Welcome Admin!');
  } else {
    popup('Login Failed', 'Invalid username or password.');
  }
}

function adminLogout() {
  adminSession = false;
  document.getElementById('dashboard').style.display = "none";
  document.getElementById('login-box').style.display = "block";
  popup('Logged Out', 'You have been logged out successfully.');
}

function showDashboard() {
  document.getElementById('total-v').textContent = vendors.length;
  const tbody = document.getElementById('admin-body');
  tbody.innerHTML = '';
  vendors.forEach(v => {
    const exp = isExpired(v.regDate);
    const status = exp ? '<span class="expired">Expired</span>' : (v.approved ? 'LIVE' : 'Pending');
    tbody.innerHTML += `<tr>
      <td><input type="checkbox" class="vendor-check" data-id="${v.id}" onchange="updateSelectedCount()"></td>
      <td>${v.name}</td>
      <td>${v.mobile}</td>
      <td>${v.service}</td>
      <td>${v.regDateTime || v.regDate}</td>
      <td>${status}</td>
      <td>
        ${!v.approved ? `<button class="glow-btn" style="background:#25d366" onclick="approve(${v.id})">Approve</button>` : ''}
      </td>
    </tr>`;
  });
  
  updateSelectedCount();
}
// ==================== UPDATE SELECTED VENDORS ====================
function updateSelected() {
    const selected = Array.from(document.querySelectorAll('.vendor-check:checked')).map(cb => parseInt(cb.dataset.id));
    
    if (selected.length === 0) {
        popup('Error', 'Please select at least one vendor to update');
        return;
    }
    
    if (selected.length > 1) {
        popup('Info', 'Please select only one vendor to update at a time');
        return;
    }
    
    const vendorId = selected[0];
    const vendor = vendors.find(v => v.id === vendorId);
    
    if (!vendor) {
        popup('Error', 'Vendor not found');
        return;
    }
    
    // Show update form for the selected vendor
    showUpdateForm(vendorId);
}

function showUpdateForm(vendorId) {
    const vendor = vendors.find(v => v.id === vendorId);
    if (!vendor) return;
    
    const container = document.getElementById('update-form-container');
    container.innerHTML = `
        <div class="update-form">
            <h4>Update Vendor: ${vendor.name}</h4>
            <input type="text" id="update-name" value="${vendor.name}" placeholder="Full Name">
            <input type="tel" id="update-mobile" value="${vendor.mobile}" placeholder="Mobile">
            <select id="update-service">
                ${CATEGORIES.map(c => `<option value="${c}" ${c === vendor.service ? 'selected' : ''}>${c}</option>`).join('')}
                <option value="Others" ${!CATEGORIES.includes(vendor.service) ? 'selected' : ''}>Others</option>
            </select>
            <input type="text" id="update-custom-service" value="${!CATEGORIES.includes(vendor.service) ? vendor.service : ''}" placeholder="Custom Service" style="${CATEGORIES.includes(vendor.service) ? 'display:none' : ''}">
            <input type="text" id="update-location" value="${vendor.location}" placeholder="Area">
            <input type="number" id="update-experience" value="${vendor.experience}" placeholder="Experience (Years)">
            <textarea id="update-description" placeholder="Description">${vendor.description}</textarea>
            <select id="update-status">
                <option value="pending" ${!vendor.approved ? 'selected' : ''}>Pending</option>
                <option value="approved" ${vendor.approved ? 'selected' : ''}>Approved</option>
            </select>
            <div style="display:flex;gap:0.5rem;justify-content:center;margin-top:1rem">
                <button class="glow-btn" onclick="saveVendorUpdate(${vendorId})">Save Changes</button>
                <button class="glow-btn" onclick="cancelUpdate()" style="background:#666">Cancel</button>
            </div>
        </div>
    `;
    
    container.style.display = 'block';
    
    // Show custom service field if "Others" is selected
    document.getElementById('update-service').addEventListener('change', function() {
        document.getElementById('update-custom-service').style.display = 
            this.value === 'Others' ? 'block' : 'none';
    });
}

function saveVendorUpdate(vendorId) {
    const vendorIndex = vendors.findIndex(v => v.id === vendorId);
    if (vendorIndex === -1) return;
    
    const serviceValue = document.getElementById('update-service').value;
    const statusValue = document.getElementById('update-status').value;
    
    vendors[vendorIndex] = {
        ...vendors[vendorIndex],
        name: document.getElementById('update-name').value.trim(),
        mobile: document.getElementById('update-mobile').value.trim(),
        service: serviceValue === 'Others' 
            ? document.getElementById('update-custom-service').value.trim() 
            : serviceValue,
        location: document.getElementById('update-location').value.trim(),
        experience: document.getElementById('update-experience').value,
        description: document.getElementById('update-description').value.trim(),
        approved: statusValue === 'approved',
        updateDate: new Date().toLocaleString('en-IN')
    };
    
    saveV();
    popup('Success', 'Vendor details updated successfully!');
    cancelUpdate();
    showDashboard();
}

function cancelUpdate() {
    document.getElementById('update-form-container').style.display = 'none';
    document.getElementById('update-form-container').innerHTML = '';
}
function updateSelectedCount() {
  const selected = document.querySelectorAll('.vendor-check:checked').length;
  document.getElementById('selected-count').textContent = `${selected} selected`;
  
  document.querySelectorAll('#admin-body tr').forEach(row => {
    const checkbox = row.querySelector('.vendor-check');
    if (checkbox && checkbox.checked) {
      row.classList.add('selected-row');
    } else {
      row.classList.remove('selected-row');
    }
  });
}

function toggleAll(source) {
  document.querySelectorAll('.vendor-check').forEach(cb => {
    cb.checked = source.checked;
    cb.dispatchEvent(new Event('change'));
  });
  updateSelectedCount();
}

// FIXED: Delete function now properly syncs with Firebase
function deleteSelected() {
  const selected = Array.from(document.querySelectorAll('.vendor-check:checked')).map(cb => parseInt(cb.dataset.id));
  
  console.log("üîç DEBUG DELETE:");
  console.log("Selected checkbox IDs:", selected);
  console.log("All vendor IDs:", vendors.map(v => v.id));
  console.log("Vendors before deletion:", vendors.length);
  
  if (selected.length === 0) {
    popup('Error', 'Please select at least one vendor to delete');
    return;
  }
  
  // Verify each selected ID exists
  selected.forEach(id => {
    const exists = vendors.some(v => v.id === id);
    console.log(`ID ${id} exists in vendors: ${exists}`);
    if (exists) {
      const vendor = vendors.find(v => v.id === id);
      console.log(`  - Vendor: ${vendor.name}, Service: ${vendor.service}`);
    }
  });
  
  if (confirm(`Delete ${selected.length} vendor(s) forever?`)) {
    const beforeCount = vendors.length;
    vendors = vendors.filter(v => !selected.includes(v.id));
    const afterCount = vendors.length;
    const deletedCount = beforeCount - afterCount;
    
    console.log(`‚úÖ Deletion result: ${deletedCount} vendors deleted`);
    console.log(`Vendors after deletion: ${afterCount}`);
    
    saveV();
    
    // Force sync with Firebase to ensure all devices get the update
    saveVendorsToFirebaseOptimized().then(() => {
      popup('Deleted', `${deletedCount} vendor(s) removed successfully from all devices`);
    });
    
    showDashboard(); 
    showVendors();
  }
}

function approve(id) {
  console.log("‚úÖ APPROVE FUNCTION CALLED - Vendor ID:", id);
  
  // Find the vendor
  const vendor = vendors.find(v => v.id === id);
  if (!vendor) {
    console.log("‚ùå Vendor not found with ID:", id);
    popup('Error', 'Vendor not found');
    return;
  }
  
  console.log("Approving vendor:", vendor.name);
  
  // Update vendor approval status
  vendors = vendors.map(v => 
    v.id === id ? {...v, approved: true} : v
  );
  
  console.log("‚úÖ Vendor approved. Updated vendors:", vendors.length);
  
  // Save to localStorage and Firebase
  saveV();
  
  // Sync with Firebase
  saveVendorsToFirebaseOptimized().then(() => {
    console.log("üî• Vendor approval synced to Firebase");
    popup('Approved!', `${vendor.name} is now LIVE and visible to customers`);
  });
  
  // Refresh the admin dashboard
  showDashboard();
  
  console.log("üîÑ UI refreshed after approval");
}

  
function addCategory() {
  const newCategoryInput = document.getElementById('new-category');
  const newCategory = newCategoryInput.value.trim();
  
  if (newCategory && !CATEGORIES.includes(newCategory)) {
    CATEGORIES.push(newCategory);
    saveCategories();
    updateCategoriesDisplay();
    newCategoryInput.value = '';
    popup('Success', 'Category added successfully');
  } else if (CATEGORIES.includes(newCategory)) {
    popup('Error', 'Category already exists');
  }
}

function deleteCategory(category) {
  if (confirm(`Are you sure you want to delete "${category}" category?`)) {
    CATEGORIES = CATEGORIES.filter(c => c !== category);
    saveCategories();
    updateCategoriesDisplay();
    popup('Success', 'Category deleted successfully');
  }
}

// Search functions (same as before)
function debounceSearch(func, delay = 300) {
  return function(...args) {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => func.apply(this, args), delay);
  };
}

// Storage functions
function saveCategories() {
  localStorage.setItem(CACHE_KEYS.CATEGORIES, JSON.stringify(CATEGORIES));
}

// Backup functions (same as before)
function completeOneClickBackup() {
  try {
    const backupData = {
      vendors: vendors,
      categories: CATEGORIES,
      timestamp: Date.now(),
      date: new Date().toLocaleString('en-IN'),
      totalVendors: vendors.length,
      totalCategories: CATEGORIES.length
    };

    const dataStr = JSON.stringify(backupData, null, 2);
    const dataBlob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(dataBlob);
    
    const link = document.createElement('a');
    link.href = url;
    link.download = `lokonex_complete_backup_${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    setTimeout(() => URL.revokeObjectURL(url), 100);
    
    popup('Backup Complete', 'Data backup downloaded successfully!');
    
  } catch (error) {
    popup('‚ùå Backup Failed', 'Error: ' + error.message);
  }
}

function showBackupInfo() {
  popup('Backup Info', 'Manual backup system is ready. Use "One-Click Backup" to download your data.');
}

function exportBackup() {
  completeOneClickBackup();
}

function importBackup() {
  document.getElementById('backup-file').click();
}

document.getElementById('backup-file').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(event) {
      try {
        const backupData = JSON.parse(event.target.result);
        if (backupData.vendors && Array.isArray(backupData.vendors)) {
          vendors = backupData.vendors;
          if (backupData.categories) {
            CATEGORIES = backupData.categories;
            saveCategories();
            updateCategoriesDisplay();
          }
          saveV();
          popup('Restore Complete', 'Data restored successfully!');
          showVendors();
          showDashboard();
        } else {
          popup('Invalid File', 'The selected file is not a valid backup.');
        }
      } catch (error) {
        popup('Error', 'Failed to read backup file: ' + error.message);
      }
    };
    reader.readAsText(file);
  }
});

function oneClickRestore() {
  document.getElementById('backup-file').click();
}

// Share function

function shareApp() {
  if (navigator.share) {
    navigator.share({
      title: 'Lokonex - Local Services Connect',
      text: 'Discover and connect with verified local service providers in your area',
      url: window.location.href
    })
    .then(() => console.log('Successful share'))
    .catch((error) => console.log('Error sharing:', error));
  } else {
    const shareUrl = window.location.href;
    navigator.clipboard.writeText(shareUrl).then(() => {
      popup('Success', 'App link copied to clipboard!');
    }).catch(() => {
      popup('Share App', 'Share this link: ' + shareUrl);
    });
  }
}

// Initialize
// Initialize
// Force refresh categories on page load
window.onload = async () => {
  // Check for updates first
  checkForUpdates();
  
  // Force update categories display
  updateCategoriesDisplay();
  updateFreeSlots();
  
  // Initialize Firebase with optimizations
  initializeFirebaseWithRetry();
  
  const savedPage = localStorage.getItem('currentPage') || 'home';
  show(savedPage);
  
  document.getElementById('vendor-form').reset();
  
  // ‚úÖ ADD MIGRATION BUTTON TO ADMIN PANEL
  addMigrationButton();
  
  // ‚úÖ START AUTO MIGRATION (optional)
  startAutoMigration();
  
  document.querySelectorAll('.feature-card').forEach(card => {
    card.style.cursor = 'pointer';
    card.onclick = () => {
      const title = card.querySelector('h3').textContent;
      if (title.includes('Find Vendors')) show('vendors');
      else if (title.includes('Register')) show('register');
    };
  });
};
</script>

<!-- Install App button -->
<button id="install-btn"
  style="position:fixed;top:65px;right:15px;z-index:999;
         background:linear-gradient(45deg,#ffd700,#ffb400);
         color:#000;border:none;border-radius:80px;
         padding:1.0rem 1rem;font-weight:300;
         box-shadow:0 0 5px rgba(255,215,0,0.6);
         font-size:0.7rem;cursor:pointer;display:flex;
         align-items:center;gap:0.4rem;">
  <i class="fas fa-download"></i> Install App
</button>

<!-- Toast popup -->
<div id="toast"
  style="visibility:hidden;min-width:240px;
         background:rgba(0,0,0,0.85);color:#fff;text-align:center;
         border-radius:50px;padding:0.8rem 1.2rem;
         position:fixed;z-index:9999;left:50%;bottom:80px;
         transform:translateX(-50%);font-size:0.9rem;
         opacity:0;transition:opacity 0.4s,bottom 0.4s;">
  App Installed Successfully!
</div>

<script>
// PWA Installation
let deferredPrompt;
const installBtn = document.getElementById('install-btn');
const toast = document.getElementById('toast');

// Show install button only if PWA is not already installed
if (window.matchMedia('(display-mode: standalone)').matches) {
  installBtn.style.display = 'none';
}

window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  installBtn.style.display = 'flex';
});

installBtn.addEventListener('click', async () => {
  if (!deferredPrompt) return;
  
  deferredPrompt.prompt();
  const { outcome } = await deferredPrompt.userChoice;
  
  if (outcome === 'accepted') {
    deferredPrompt = null;
    installBtn.style.display = 'none';
    showToast('App Installed Successfully!');
  }
});

// Quick validation function
function validateForm(f) {
  if (!f.name.value.trim()) {
    popup('Error', 'Please enter your full name');
    return false;
  }
  if (!f.mobile.value.trim() || f.mobile.value.trim().length < 10) {
    popup('Error', 'Please enter a valid mobile number');
    return false;
  }
  if (!f.service.value) {
    popup('Error', 'Please select a service category');
    return false;
  }
  if (f.service.value === 'Others' && !f.custom_service.value.trim()) {
    popup('Error', 'Please enter your service');
    return false;
  }
  if (!f.area.value.trim()) {
    popup('Error', 'Please enter your area');
    return false;
  }
  if (!f.exp.value || f.exp.value < 0) {
    popup('Error', 'Please enter valid experience');
    return false;
  }
  if (!f.desc.value.trim()) {
    popup('Error', 'Please enter service description');
    return false;
  }
  return true;
}

function showToast(message) {
  toast.textContent = message;
  toast.style.visibility = 'visible';
  toast.style.opacity = '1';
  toast.style.bottom = '80px';
  
  setTimeout(() => {
    toast.style.opacity = '0';
    toast.style.bottom = '50px';
    setTimeout(() => {
      toast.style.visibility = 'hidden';
    }, 400);
  }, 3000);
}

window.addEventListener('appinstalled', () => {
  deferredPrompt = null;
  installBtn.style.display = 'none';
  showToast('App Installed Successfully!');
});

// ==================== TEST FUNCTIONS ====================
function testDeleteFirstVendor() {
  if (vendors.length > 0) {
    const firstVendor = vendors[0];
    console.log("üß™ TEST: Deleting first vendor:", firstVendor.name, firstVendor.id);
    
    if (confirm("Test: Delete " + firstVendor.name + "?")) {
      vendors = vendors.filter(function(v) { return v.id !== firstVendor.id; });
      console.log("‚úÖ Test deletion successful. Remaining vendors:", vendors.length);
      
      saveV();
      showDashboard();
      showVendors();
      popup('Test', 'Manual deletion test successful');
    }
  } else {
    console.log("‚ùå No vendors to delete");
  }
}

function checkVendorStatus(vendorId = null) {
  if (!vendorId && vendors.length > 0) {
    vendorId = vendors[0].id;
  }
  
  const vendor = vendors.find(v => v.id === vendorId);
  if (vendor) {
    console.log("üîç Vendor status:", {
      name: vendor.name,
      id: vendor.id,
      approved: vendor.approved,
      regDate: vendor.regDate,
      expired: isExpired(vendor.regDate),
      visible: vendor.approved && !isExpired(vendor.regDate)
    });
    return vendor;
  } else {
    console.log("‚ùå Vendor not found with ID:", vendorId);
    return null;
  }
}

function findApprovedVendors() {
  const approvedVendors = vendors.filter(v => v.approved && !isExpired(v.regDate));
  console.log("‚úÖ Approved & visible vendors:", approvedVendors.length);
  console.log(approvedVendors.map(v => ({name: v.name, id: v.id, service: v.service})));
  return approvedVendors;
}
// ==================== END TEST FUNCTIONS ====================
</script>
<script>
// Auto-update notification
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.addEventListener('controllerchange', () => {
    console.log('New version available! Reloading...');
    showUpdateNotification();
  });
}

function showUpdateNotification() {
  if (document.getElementById('update-notification')) return;
  
  const notification = document.createElement('div');
  notification.id = 'update-notification';
  notification.innerHTML = `
    <div style="position:fixed; top:70px; right:20px; background:#25d366; color:white; padding:15px; border-radius:10px; z-index:9999; box-shadow:0 4px 12px rgba(0,0,0,0.3); max-width:300px;">
      <strong>üîÑ Update Available!</strong><br>
      <small>New features available. Reload to get the latest version.</small><br>
      <button onclick="location.reload()" style="background:white; color:#25d366; border:none; padding:8px 15px; border-radius:5px; margin-top:8px; cursor:pointer; font-weight:bold">Reload Now</button>
    </div>
  `;
  document.body.appendChild(notification);
  
  setTimeout(() => {
    if (notification.parentNode) notification.remove();
  }, 15000);
}

// Check for updates on page load
navigator.serviceWorker?.ready.then(registration => {
  registration.update();
});
</script>

  <script>
// FINAL ATTEMPT - Run when everything is loaded
window.addEventListener('load', function() {
  console.log("üéØ Page fully loaded - final vendor check");
  
  // Wait a bit more then check
  setTimeout(function() {
    if (window.vendors && window.vendors.length > 0) {
      console.log("‚úÖ Final check - vendors loaded:", window.vendors.length);
      if (typeof showVendors === 'function') showVendors();
    } else {
      console.log("‚ùå Final check - no vendors, forcing load...");
      loadMobileVendors();
    }
  }, 3000);
});
</script>

</body>
</html>